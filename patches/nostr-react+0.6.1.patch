diff --git a/node_modules/nostr-react/dist/core.d.ts b/node_modules/nostr-react/dist/core.d.ts
index 6afe4e7..1b6db15 100644
--- a/node_modules/nostr-react/dist/core.d.ts
+++ b/node_modules/nostr-react/dist/core.d.ts
@@ -3,6 +3,7 @@ import { Relay, Filter, Event as NostrEvent, Sub } from "nostr-tools";
 type OnConnectFunc = (relay: Relay) => void;
 type OnDisconnectFunc = (relay: Relay) => void;
 type OnEventFunc = (event: NostrEvent) => void;
+type OnDoneFunc = () => void;
 type OnSubscribeFunc = (sub: Sub, relay: Relay) => void;
 interface NostrContextType {
     isLoading: boolean;
@@ -29,5 +30,6 @@ export declare function useNostrEvents({ filter, enabled, }: {
     unsubscribe: () => void | void;
     onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => void;
     onEvent: (_onEventCallback: OnEventFunc) => void;
+    onDone: (_onDoneCallback: OnDoneFunc) => void;
 };
 export {};
diff --git a/node_modules/nostr-react/dist/nostr-react.cjs.development.js b/node_modules/nostr-react/dist/nostr-react.cjs.development.js
index 7a43172..71c0dc8 100644
--- a/node_modules/nostr-react/dist/nostr-react.cjs.development.js
+++ b/node_modules/nostr-react/dist/nostr-react.cjs.development.js
@@ -398,18 +398,62 @@ function NostrProvider(_ref) {
   var _useState2 = react.useState([]),
     connectedRelays = _useState2[0],
     setConnectedRelays = _useState2[1];
+  var _useState3 = react.useState([]),
+    relays = _useState3[0],
+    setRelays = _useState3[1];
+  var relayUrlsRef = react.useRef([]);
   var onConnectCallback = null;
   var onDisconnectCallback = null;
-  var isFirstRender = react.useRef(true);
-  var connectToRelays = react.useCallback(function () {
+  var disconnectToRelays = react.useCallback(function (relayUrls) {
     relayUrls.forEach( /*#__PURE__*/function () {
       var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(relayUrl) {
-        var relay;
+        var _relays$find;
         return _regeneratorRuntime().wrap(function _callee$(_context) {
           while (1) {
             switch (_context.prev = _context.next) {
+              case 0:
+                _context.next = 2;
+                return (_relays$find = relays.find(function (relay) {
+                  return relay.url === relayUrl;
+                })) == null ? void 0 : _relays$find.close();
+              case 2:
+                setRelays(function (prev) {
+                  return prev.filter(function (r) {
+                    return r.url !== relayUrl;
+                  });
+                });
+              case 3:
+              case "end":
+                return _context.stop();
+            }
+          }
+        }, _callee);
+      }));
+      return function (_x) {
+        return _ref2.apply(this, arguments);
+      };
+    }());
+  }, [relays]);
+  var connectToRelays = react.useCallback(function (relayUrls) {
+    relayUrls.forEach( /*#__PURE__*/function () {
+      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(relayUrl) {
+        var relay;
+        return _regeneratorRuntime().wrap(function _callee2$(_context2) {
+          while (1) {
+            switch (_context2.prev = _context2.next) {
               case 0:
                 relay = nostrTools.relayInit(relayUrl);
+                if (!(connectedRelays.findIndex(function (r) {
+                  return r.url === relayUrl;
+                }) >= 0)) {
+                  _context2.next = 3;
+                  break;
+                }
+                return _context2.abrupt("return");
+              case 3:
+                setRelays(function (prev) {
+                  return uniqBy([].concat(prev, [relay]), "url");
+                });
                 relay.connect();
                 relay.on("connect", function () {
                   log(debug, "info", "\u2705 nostr (" + relayUrl + "): Connected!");
@@ -431,25 +475,30 @@ function NostrProvider(_ref) {
                 relay.on("error", function () {
                   log(debug, "error", "\u274C nostr (" + relayUrl + "): Connection error!");
                 });
-              case 5:
+              case 8:
               case "end":
-                return _context.stop();
+                return _context2.stop();
             }
           }
-        }, _callee);
+        }, _callee2);
       }));
-      return function (_x) {
-        return _ref2.apply(this, arguments);
+      return function (_x2) {
+        return _ref3.apply(this, arguments);
       };
     }());
-  }, []);
+  }, [connectedRelays, debug, onConnectCallback, onDisconnectCallback]);
   react.useEffect(function () {
-    // Make sure we only start the relays once (even in strict-mode)
-    if (isFirstRender.current) {
-      isFirstRender.current = false;
-      connectToRelays();
+    if (relayUrlsRef.current === relayUrls) {
+      // relayUrls isn't updated, skip
+      return;
     }
-  }, []);
+    var relayUrlsToDisconnect = relayUrlsRef.current.filter(function (relayUrl) {
+      return !relayUrls.includes(relayUrl);
+    });
+    disconnectToRelays(relayUrlsToDisconnect);
+    connectToRelays(relayUrls);
+    relayUrlsRef.current = relayUrls;
+  }, [relayUrls, connectToRelays, disconnectToRelays]);
   var publish = function publish(event) {
     return connectedRelays.map(function (relay) {
       log(debug, "info", "\u2B06\uFE0F nostr (" + relay.url + "): Sending event:", event);
@@ -480,25 +529,29 @@ function NostrProvider(_ref) {
 function useNostr() {
   return react.useContext(NostrContext);
 }
-function useNostrEvents(_ref3) {
-  var filter = _ref3.filter,
-    _ref3$enabled = _ref3.enabled,
-    enabled = _ref3$enabled === void 0 ? true : _ref3$enabled;
+function useNostrEvents(_ref4) {
+  var filter = _ref4.filter,
+    _ref4$enabled = _ref4.enabled,
+    enabled = _ref4$enabled === void 0 ? true : _ref4$enabled;
   var _useNostr = useNostr(),
-    isLoading = _useNostr.isLoading,
+    isLoadingProvider = _useNostr.isLoading,
     onConnect = _useNostr.onConnect,
     debug = _useNostr.debug,
     connectedRelays = _useNostr.connectedRelays;
-  var _useState3 = react.useState([]),
-    events = _useState3[0],
-    setEvents = _useState3[1];
-  var _useState4 = react.useState(function () {
+  var _useState4 = react.useState(true),
+    isLoading = _useState4[0],
+    setIsLoading = _useState4[1];
+  var _useState5 = react.useState([]),
+    events = _useState5[0],
+    setEvents = _useState5[1];
+  var _useState6 = react.useState(function () {
       return;
     }),
-    unsubscribe = _useState4[0],
-    setUnsubscribe = _useState4[1];
+    unsubscribe = _useState6[0],
+    setUnsubscribe = _useState6[1];
   var onEventCallback = null;
   var onSubscribeCallback = null;
+  var onDoneCallback = null;
   // Lets us detect changes in the nested filter object for the useEffect hook
   var filterBase64 = typeof window !== "undefined" ? window.btoa(JSON.stringify(filter)) : null;
   var _unsubscribe = function _unsubscribe(sub, relay) {
@@ -508,6 +561,7 @@ function useNostrEvents(_ref3) {
   var subscribe = react.useCallback(function (relay, filter) {
     log(debug, "info", "\uD83D\uDC42 nostr (" + relay.url + "): Subscribing to filter:", filter);
     var sub = relay.sub([filter]);
+    setIsLoading(true);
     var unsubscribeFunc = function unsubscribeFunc() {
       _unsubscribe(sub, relay);
     };
@@ -521,6 +575,10 @@ function useNostrEvents(_ref3) {
         return [event].concat(_events);
       });
     });
+    sub.on("eose", function () {
+      setIsLoading(false);
+      onDoneCallback == null ? void 0 : onDoneCallback();
+    });
     return sub;
   }, []);
   react.useEffect(function () {
@@ -534,9 +592,9 @@ function useNostrEvents(_ref3) {
       };
     });
     return function () {
-      relaySubs.forEach(function (_ref4) {
-        var sub = _ref4.sub,
-          relay = _ref4.relay;
+      relaySubs.forEach(function (_ref5) {
+        var sub = _ref5.sub,
+          relay = _ref5.relay;
         _unsubscribe(sub, relay);
       });
     };
@@ -546,7 +604,7 @@ function useNostrEvents(_ref3) {
     return b.created_at - a.created_at;
   });
   return {
-    isLoading: isLoading,
+    isLoading: isLoading || isLoadingProvider,
     events: sortedEvents,
     onConnect: onConnect,
     connectedRelays: connectedRelays,
@@ -560,6 +618,11 @@ function useNostrEvents(_ref3) {
       if (_onEventCallback) {
         onEventCallback = _onEventCallback;
       }
+    },
+    onDone: function onDone(_onDoneCallback) {
+      if (_onDoneCallback) {
+        onDoneCallback = _onDoneCallback;
+      }
     }
   };
 }
@@ -601,14 +664,16 @@ function useProfileQueue(_ref) {
   };
 }
 function useProfile(_ref2) {
-  var pubkey = _ref2.pubkey;
+  var pubkey = _ref2.pubkey,
+    _ref2$enabled = _ref2.enabled,
+    _enabled = _ref2$enabled === void 0 ? true : _ref2$enabled;
   var _useAtom3 = jotai.useAtom(requestedPubkeysAtom),
     setRequestedPubkeys = _useAtom3[1];
   var _useProfileQueue = useProfileQueue({
       pubkey: pubkey
     }),
     pubkeysToFetch = _useProfileQueue.pubkeysToFetch;
-  var enabled = !!pubkeysToFetch.length;
+  var enabled = _enabled && !!pubkeysToFetch.length;
   var _useAtom4 = jotai.useAtom(fetchedProfilesAtom),
     fetchedProfiles = _useAtom4[0],
     setFetchedProfiles = _useAtom4[1];
@@ -620,7 +685,9 @@ function useProfile(_ref2) {
       enabled: enabled
     }),
     onEvent = _useNostrEvents.onEvent,
-    onSubscribe = _useNostrEvents.onSubscribe;
+    onSubscribe = _useNostrEvents.onSubscribe,
+    isLoading = _useNostrEvents.isLoading,
+    onDone = _useNostrEvents.onDone;
   onSubscribe(function () {
     // Reset list
     // (We've already opened a subscription to these pubkeys now)
@@ -645,6 +712,8 @@ function useProfile(_ref2) {
   var metadata = fetchedProfiles[pubkey];
   var npub = nostrTools.nip19.npubEncode(pubkey);
   return {
+    isLoading: isLoading,
+    onDone: onDone,
     data: metadata ? _extends({}, metadata, {
       npub: npub
     }) : undefined
diff --git a/node_modules/nostr-react/dist/nostr-react.cjs.development.js.map b/node_modules/nostr-react/dist/nostr-react.cjs.development.js.map
index abb019a..fb76024 100644
--- a/node_modules/nostr-react/dist/nostr-react.cjs.development.js.map
+++ b/node_modules/nostr-react/dist/nostr-react.cjs.development.js.map
@@ -1 +1 @@
-{"version":3,"file":"nostr-react.cjs.development.js","sources":["../src/utils.ts","../src/core.tsx","../src/useProfile.tsx"],"sourcesContent":["export const uniqBy = <T>(arr: T[], key: keyof T): T[] => {\n  return Object.values(\n    arr.reduce(\n      (map, item) => ({\n        ...map,\n        [`${item[key]}`]: item,\n      }),\n      {},\n    ),\n  )\n}\n\nexport const uniqValues = (value: string, index: number, self: string[]) => {\n  return self.indexOf(value) === index\n}\n\nexport const dateToUnix = (_date?: Date) => {\n  const date = _date || new Date()\n\n  return Math.floor(date.getTime() / 1000)\n}\n","import {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\nimport { Provider as JotaiProvider } from \"jotai\"\n\nimport { Relay, Filter, Event as NostrEvent, relayInit, Sub } from \"nostr-tools\"\n\nimport { uniqBy } from \"./utils\"\n\ntype OnConnectFunc = (relay: Relay) => void\ntype OnDisconnectFunc = (relay: Relay) => void\ntype OnEventFunc = (event: NostrEvent) => void\ntype OnSubscribeFunc = (sub: Sub, relay: Relay) => void\n\ninterface NostrContextType {\n  isLoading: boolean\n  debug?: boolean\n  connectedRelays: Relay[]\n  onConnect: (_onConnectCallback?: OnConnectFunc) => void\n  onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => void\n  publish: (event: NostrEvent) => void\n}\n\nconst NostrContext = createContext<NostrContextType>({\n  isLoading: true,\n  connectedRelays: [],\n  onConnect: () => null,\n  onDisconnect: () => null,\n  publish: () => null,\n})\n\nconst log = (\n  isOn: boolean | undefined,\n  type: \"info\" | \"error\" | \"warn\",\n  ...args: unknown[]\n) => {\n  if (!isOn) return\n  console[type](...args)\n}\n\nexport function NostrProvider({\n  children,\n  relayUrls,\n  debug,\n}: {\n  children: ReactNode\n  relayUrls: string[]\n  debug?: boolean\n}) {\n  const [isLoading, setIsLoading] = useState(true)\n  const [connectedRelays, setConnectedRelays] = useState<Relay[]>([])\n\n  let onConnectCallback: null | OnConnectFunc = null\n  let onDisconnectCallback: null | OnDisconnectFunc = null\n\n  const isFirstRender = useRef(true)\n\n  const connectToRelays = useCallback(() => {\n    relayUrls.forEach(async (relayUrl) => {\n      const relay = relayInit(relayUrl)\n      relay.connect()\n\n      relay.on(\"connect\", () => {\n        log(debug, \"info\", `âœ… nostr (${relayUrl}): Connected!`)\n        setIsLoading(false)\n        onConnectCallback?.(relay)\n        setConnectedRelays((prev) => uniqBy([...prev, relay], \"url\"))\n      })\n\n      relay.on(\"disconnect\", () => {\n        log(debug, \"warn\", `ðŸšª nostr (${relayUrl}): Connection closed.`)\n        onDisconnectCallback?.(relay)\n        setConnectedRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n      })\n\n      relay.on(\"error\", () => {\n        log(debug, \"error\", `âŒ nostr (${relayUrl}): Connection error!`)\n      })\n    })\n  }, [])\n\n  useEffect(() => {\n    // Make sure we only start the relays once (even in strict-mode)\n    if (isFirstRender.current) {\n      isFirstRender.current = false\n      connectToRelays()\n    }\n  }, [])\n\n  const publish = (event: NostrEvent) => {\n    return connectedRelays.map((relay) => {\n      log(debug, \"info\", `â¬†ï¸ nostr (${relay.url}): Sending event:`, event)\n\n      return relay.publish(event)\n    })\n  }\n\n  const value: NostrContextType = {\n    debug,\n    isLoading,\n    connectedRelays,\n    publish,\n    onConnect: (_onConnectCallback?: OnConnectFunc) => {\n      if (_onConnectCallback) {\n        onConnectCallback = _onConnectCallback\n      }\n    },\n    onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => {\n      if (_onDisconnectCallback) {\n        onDisconnectCallback = _onDisconnectCallback\n      }\n    },\n  }\n\n  return <NostrContext.Provider value={value}>{children}</NostrContext.Provider>\n}\n\nexport function useNostr() {\n  return useContext(NostrContext)\n}\n\nexport function useNostrEvents({\n  filter,\n  enabled = true,\n}: {\n  filter: Filter\n  enabled?: boolean\n}) {\n  const { isLoading, onConnect, debug, connectedRelays } = useNostr()\n  const [events, setEvents] = useState<NostrEvent[]>([])\n  const [unsubscribe, setUnsubscribe] = useState<() => void | void>(() => {\n    return\n  })\n\n  let onEventCallback: null | OnEventFunc = null\n  let onSubscribeCallback: null | OnSubscribeFunc = null\n\n  // Lets us detect changes in the nested filter object for the useEffect hook\n  const filterBase64 =\n    typeof window !== \"undefined\" ? window.btoa(JSON.stringify(filter)) : null\n\n  const _unsubscribe = (sub: Sub, relay: Relay) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ™‰ nostr (${relay.url}): Unsubscribing from filter:`,\n      filter,\n    )\n    return sub.unsub()\n  }\n\n  const subscribe = useCallback((relay: Relay, filter: Filter) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ‘‚ nostr (${relay.url}): Subscribing to filter:`,\n      filter,\n    )\n    const sub = relay.sub([filter])\n\n    const unsubscribeFunc = () => {\n      _unsubscribe(sub, relay)\n    }\n\n    setUnsubscribe(() => unsubscribeFunc)\n\n    sub.on(\"event\", (event: NostrEvent) => {\n      log(debug, \"info\", `â¬‡ï¸ nostr (${relay.url}): Received event:`, event)\n      onEventCallback?.(event)\n      setEvents((_events) => {\n        return [event, ..._events]\n      })\n    })\n\n    return sub\n  }, [])\n\n  useEffect(() => {\n    if (!enabled) return\n\n    const relaySubs = connectedRelays.map((relay) => {\n      const sub = subscribe(relay, filter)\n\n      onSubscribeCallback?.(sub, relay)\n\n      return {\n        sub,\n        relay,\n      }\n    })\n\n    return () => {\n      relaySubs.forEach(({ sub, relay }) => {\n        _unsubscribe(sub, relay)\n      })\n    }\n  }, [connectedRelays, filterBase64, enabled])\n\n  const uniqEvents = events.length > 0 ? uniqBy(events, \"id\") : []\n  const sortedEvents = uniqEvents.sort((a, b) => b.created_at - a.created_at)\n\n  return {\n    isLoading,\n    events: sortedEvents,\n    onConnect,\n    connectedRelays,\n    unsubscribe,\n    onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => {\n      if (_onSubscribeCallback) {\n        onSubscribeCallback = _onSubscribeCallback\n      }\n    },\n    onEvent: (_onEventCallback: OnEventFunc) => {\n      if (_onEventCallback) {\n        onEventCallback = _onEventCallback\n      }\n    },\n  }\n}\n","import { atom, useAtom } from \"jotai\"\nimport { nip19 } from \"nostr-tools\"\nimport { useEffect, useState } from \"react\"\n\nimport { useNostrEvents } from \"./core\"\nimport { uniqValues } from \"./utils\"\n\ninterface Metadata {\n  name?: string\n  display_name?: string\n  picture?: string\n  about?: string\n  website?: string\n  lud06?: string\n  lud16?: string\n  nip06?: string\n}\n\nconst QUEUE_DEBOUNCE_DURATION = 100\n\nlet timer: NodeJS.Timeout | undefined = undefined\n\nconst queuedPubkeysAtom = atom<string[]>([])\nconst requestedPubkeysAtom = atom<string[]>([])\nconst fetchedProfilesAtom = atom<Record<string, Metadata>>({})\n\nfunction useProfileQueue({ pubkey }: { pubkey: string }) {\n  const [isReadyToFetch, setIsReadyToFetch] = useState(false)\n\n  const [queuedPubkeys, setQueuedPubkeys] = useAtom(queuedPubkeysAtom)\n\n  const [requestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const alreadyRequested = !!requestedPubkeys.includes(pubkey)\n\n  useEffect(() => {\n    if (alreadyRequested) {\n      return\n    }\n\n    clearTimeout(timer)\n\n    timer = setTimeout(() => {\n      setIsReadyToFetch(true)\n    }, QUEUE_DEBOUNCE_DURATION)\n\n    setQueuedPubkeys((_pubkeys: string[]) => {\n      // Unique values only:\n      const arr = [..._pubkeys, pubkey].filter(uniqValues).filter((_pubkey) => {\n        return !requestedPubkeys.includes(_pubkey)\n      })\n\n      return arr\n    })\n  }, [pubkey, setQueuedPubkeys, alreadyRequested, requestedPubkeys])\n\n  return {\n    pubkeysToFetch: isReadyToFetch ? queuedPubkeys : [],\n  }\n}\n\nexport function useProfile({ pubkey }: { pubkey: string }) {\n  const [, setRequestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const { pubkeysToFetch } = useProfileQueue({ pubkey })\n  const enabled = !!pubkeysToFetch.length\n\n  const [fetchedProfiles, setFetchedProfiles] = useAtom(fetchedProfilesAtom)\n\n  const { onEvent, onSubscribe } = useNostrEvents({\n    filter: {\n      kinds: [0],\n      authors: pubkeysToFetch,\n    },\n    enabled,\n  })\n\n  onSubscribe(() => {\n    // Reset list\n    // (We've already opened a subscription to these pubkeys now)\n    setRequestedPubkeys((_pubkeys) => {\n      return [..._pubkeys, ...pubkeysToFetch].filter(uniqValues)\n    })\n  })\n\n  onEvent((rawMetadata) => {\n    try {\n      const metadata: Metadata = JSON.parse(rawMetadata.content)\n      const metaPubkey = rawMetadata.pubkey\n\n      if (metadata) {\n        setFetchedProfiles((_profiles: Record<string, Metadata>) => {\n          return {\n            ..._profiles,\n            [metaPubkey]: metadata,\n          }\n        })\n      }\n    } catch (err) {\n      console.error(err, rawMetadata)\n    }\n  })\n\n  const metadata = fetchedProfiles[pubkey]\n  const npub = nip19.npubEncode(pubkey)\n\n  return {\n    data: metadata\n      ? {\n          ...metadata,\n          npub,\n        }\n      : undefined,\n  }\n}\n"],"names":["uniqBy","arr","key","Object","values","reduce","map","item","uniqValues","value","index","self","indexOf","dateToUnix","_date","date","Date","Math","floor","getTime","NostrContext","createContext","isLoading","connectedRelays","onConnect","onDisconnect","publish","log","isOn","type","args","console","NostrProvider","children","relayUrls","debug","useState","setIsLoading","setConnectedRelays","onConnectCallback","onDisconnectCallback","isFirstRender","useRef","connectToRelays","useCallback","forEach","relayUrl","relay","relayInit","connect","on","prev","filter","r","url","useEffect","current","event","_onConnectCallback","_onDisconnectCallback","_jsx","Provider","useNostr","useContext","useNostrEvents","enabled","events","setEvents","unsubscribe","setUnsubscribe","onEventCallback","onSubscribeCallback","filterBase64","window","btoa","JSON","stringify","_unsubscribe","sub","unsub","subscribe","unsubscribeFunc","_events","relaySubs","uniqEvents","length","sortedEvents","sort","a","b","created_at","onSubscribe","_onSubscribeCallback","onEvent","_onEventCallback","QUEUE_DEBOUNCE_DURATION","timer","undefined","queuedPubkeysAtom","atom","requestedPubkeysAtom","fetchedProfilesAtom","useProfileQueue","pubkey","isReadyToFetch","setIsReadyToFetch","useAtom","queuedPubkeys","setQueuedPubkeys","requestedPubkeys","alreadyRequested","includes","clearTimeout","setTimeout","_pubkeys","_pubkey","pubkeysToFetch","useProfile","setRequestedPubkeys","fetchedProfiles","setFetchedProfiles","kinds","authors","rawMetadata","metadata","parse","content","metaPubkey","_profiles","err","error","npub","nip19","npubEncode","data"],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"nostr-react.cjs.development.js","sources":["../src/utils.ts","../src/core.tsx","../src/useProfile.tsx"],"sourcesContent":["export const uniqBy = <T>(arr: T[], key: keyof T): T[] => {\n  return Object.values(\n    arr.reduce(\n      (map, item) => ({\n        ...map,\n        [`${item[key]}`]: item,\n      }),\n      {},\n    ),\n  )\n}\n\nexport const uniqValues = (value: string, index: number, self: string[]) => {\n  return self.indexOf(value) === index\n}\n\nexport const dateToUnix = (_date?: Date) => {\n  const date = _date || new Date()\n\n  return Math.floor(date.getTime() / 1000)\n}\n","import {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\n\nimport { Relay, Filter, Event as NostrEvent, relayInit, Sub } from \"nostr-tools\"\n\nimport { uniqBy } from \"./utils\"\n\ntype OnConnectFunc = (relay: Relay) => void\ntype OnDisconnectFunc = (relay: Relay) => void\ntype OnEventFunc = (event: NostrEvent) => void\ntype OnDoneFunc = () => void\ntype OnSubscribeFunc = (sub: Sub, relay: Relay) => void\n\ninterface NostrContextType {\n  isLoading: boolean\n  debug?: boolean\n  connectedRelays: Relay[]\n  onConnect: (_onConnectCallback?: OnConnectFunc) => void\n  onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => void\n  publish: (event: NostrEvent) => void\n}\n\nconst NostrContext = createContext<NostrContextType>({\n  isLoading: true,\n  connectedRelays: [],\n  onConnect: () => null,\n  onDisconnect: () => null,\n  publish: () => null,\n})\n\nconst log = (\n  isOn: boolean | undefined,\n  type: \"info\" | \"error\" | \"warn\",\n  ...args: unknown[]\n) => {\n  if (!isOn) return\n  console[type](...args)\n}\n\nexport function NostrProvider({\n  children,\n  relayUrls,\n  debug,\n}: {\n  children: ReactNode\n  relayUrls: string[]\n  debug?: boolean\n}) {\n  const [isLoading, setIsLoading] = useState(true)\n  const [connectedRelays, setConnectedRelays] = useState<Relay[]>([])\n  const [relays, setRelays] = useState<Relay[]>([])\n  const relayUrlsRef = useRef<string[]>([])\n\n  let onConnectCallback: null | OnConnectFunc = null\n  let onDisconnectCallback: null | OnDisconnectFunc = null\n\n  const disconnectToRelays = useCallback(\n    (relayUrls: string[]) => {\n      relayUrls.forEach(async (relayUrl) => {\n        await relays.find((relay) => relay.url === relayUrl)?.close()\n        setRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n      })\n    },\n    [relays],\n  )\n\n  const connectToRelays = useCallback(\n    (relayUrls: string[]) => {\n      relayUrls.forEach(async (relayUrl) => {\n        const relay = relayInit(relayUrl)\n\n        if (connectedRelays.findIndex((r) => r.url === relayUrl) >= 0) {\n          // already connected, skip\n          return\n        }\n\n        setRelays((prev) => uniqBy([...prev, relay], \"url\"))\n        relay.connect()\n\n        relay.on(\"connect\", () => {\n          log(debug, \"info\", `âœ… nostr (${relayUrl}): Connected!`)\n          setIsLoading(false)\n          onConnectCallback?.(relay)\n          setConnectedRelays((prev) => uniqBy([...prev, relay], \"url\"))\n        })\n\n        relay.on(\"disconnect\", () => {\n          log(debug, \"warn\", `ðŸšª nostr (${relayUrl}): Connection closed.`)\n          onDisconnectCallback?.(relay)\n          setConnectedRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n        })\n\n        relay.on(\"error\", () => {\n          log(debug, \"error\", `âŒ nostr (${relayUrl}): Connection error!`)\n        })\n      })\n    },\n    [connectedRelays, debug, onConnectCallback, onDisconnectCallback],\n  )\n\n  useEffect(() => {\n    if (relayUrlsRef.current === relayUrls) {\n      // relayUrls isn't updated, skip\n      return\n    }\n\n    const relayUrlsToDisconnect = relayUrlsRef.current.filter(\n      (relayUrl) => !relayUrls.includes(relayUrl),\n    )\n\n    disconnectToRelays(relayUrlsToDisconnect)\n    connectToRelays(relayUrls)\n\n    relayUrlsRef.current = relayUrls\n  }, [relayUrls, connectToRelays, disconnectToRelays])\n\n  const publish = (event: NostrEvent) => {\n    return connectedRelays.map((relay) => {\n      log(debug, \"info\", `â¬†ï¸ nostr (${relay.url}): Sending event:`, event)\n\n      return relay.publish(event)\n    })\n  }\n\n  const value: NostrContextType = {\n    debug,\n    isLoading,\n    connectedRelays,\n    publish,\n    onConnect: (_onConnectCallback?: OnConnectFunc) => {\n      if (_onConnectCallback) {\n        onConnectCallback = _onConnectCallback\n      }\n    },\n    onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => {\n      if (_onDisconnectCallback) {\n        onDisconnectCallback = _onDisconnectCallback\n      }\n    },\n  }\n\n  return <NostrContext.Provider value={value}>{children}</NostrContext.Provider>\n}\n\nexport function useNostr() {\n  return useContext(NostrContext)\n}\n\nexport function useNostrEvents({\n  filter,\n  enabled = true,\n}: {\n  filter: Filter\n  enabled?: boolean\n}) {\n  const {\n    isLoading: isLoadingProvider,\n    onConnect,\n    debug,\n    connectedRelays,\n  } = useNostr()\n\n  const [isLoading, setIsLoading] = useState(true)\n  const [events, setEvents] = useState<NostrEvent[]>([])\n  const [unsubscribe, setUnsubscribe] = useState<() => void | void>(() => {\n    return\n  })\n\n  let onEventCallback: null | OnEventFunc = null\n  let onSubscribeCallback: null | OnSubscribeFunc = null\n  let onDoneCallback: null | OnDoneFunc = null\n\n  // Lets us detect changes in the nested filter object for the useEffect hook\n  const filterBase64 =\n    typeof window !== \"undefined\" ? window.btoa(JSON.stringify(filter)) : null\n\n  const _unsubscribe = (sub: Sub, relay: Relay) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ™‰ nostr (${relay.url}): Unsubscribing from filter:`,\n      filter,\n    )\n    return sub.unsub()\n  }\n\n  const subscribe = useCallback((relay: Relay, filter: Filter) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ‘‚ nostr (${relay.url}): Subscribing to filter:`,\n      filter,\n    )\n    const sub = relay.sub([filter])\n\n    setIsLoading(true)\n\n    const unsubscribeFunc = () => {\n      _unsubscribe(sub, relay)\n    }\n\n    setUnsubscribe(() => unsubscribeFunc)\n\n    sub.on(\"event\", (event: NostrEvent) => {\n      log(debug, \"info\", `â¬‡ï¸ nostr (${relay.url}): Received event:`, event)\n      onEventCallback?.(event)\n      setEvents((_events) => {\n        return [event, ..._events]\n      })\n    })\n\n    sub.on(\"eose\", () => {\n      setIsLoading(false)\n      onDoneCallback?.()\n    })\n\n    return sub\n  }, [])\n\n  useEffect(() => {\n    if (!enabled) return\n\n    const relaySubs = connectedRelays.map((relay) => {\n      const sub = subscribe(relay, filter)\n\n      onSubscribeCallback?.(sub, relay)\n\n      return {\n        sub,\n        relay,\n      }\n    })\n\n    return () => {\n      relaySubs.forEach(({ sub, relay }) => {\n        _unsubscribe(sub, relay)\n      })\n    }\n  }, [connectedRelays, filterBase64, enabled])\n\n  const uniqEvents = events.length > 0 ? uniqBy(events, \"id\") : []\n  const sortedEvents = uniqEvents.sort((a, b) => b.created_at - a.created_at)\n\n  return {\n    isLoading: isLoading || isLoadingProvider,\n    events: sortedEvents,\n    onConnect,\n    connectedRelays,\n    unsubscribe,\n    onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => {\n      if (_onSubscribeCallback) {\n        onSubscribeCallback = _onSubscribeCallback\n      }\n    },\n    onEvent: (_onEventCallback: OnEventFunc) => {\n      if (_onEventCallback) {\n        onEventCallback = _onEventCallback\n      }\n    },\n    onDone: (_onDoneCallback: OnDoneFunc) => {\n      if (_onDoneCallback) {\n        onDoneCallback = _onDoneCallback\n      }\n    },\n  }\n}\n","import { atom, useAtom } from \"jotai\"\nimport { nip19 } from \"nostr-tools\"\nimport { useEffect, useState } from \"react\"\n\nimport { useNostrEvents } from \"./core\"\nimport { uniqValues } from \"./utils\"\n\nexport interface Metadata {\n  name?: string\n  username?: string\n  display_name?: string\n  picture?: string\n  banner?: string\n  about?: string\n  website?: string\n  lud06?: string\n  lud16?: string\n  nip05?: string\n}\n\nconst QUEUE_DEBOUNCE_DURATION = 100\n\nlet timer: NodeJS.Timeout | undefined = undefined\n\nconst queuedPubkeysAtom = atom<string[]>([])\nconst requestedPubkeysAtom = atom<string[]>([])\nconst fetchedProfilesAtom = atom<Record<string, Metadata>>({})\n\nfunction useProfileQueue({ pubkey }: { pubkey: string }) {\n  const [isReadyToFetch, setIsReadyToFetch] = useState(false)\n\n  const [queuedPubkeys, setQueuedPubkeys] = useAtom(queuedPubkeysAtom)\n\n  const [requestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const alreadyRequested = !!requestedPubkeys.includes(pubkey)\n\n  useEffect(() => {\n    if (alreadyRequested) {\n      return\n    }\n\n    clearTimeout(timer)\n\n    timer = setTimeout(() => {\n      setIsReadyToFetch(true)\n    }, QUEUE_DEBOUNCE_DURATION)\n\n    setQueuedPubkeys((_pubkeys: string[]) => {\n      // Unique values only:\n      const arr = [..._pubkeys, pubkey].filter(uniqValues).filter((_pubkey) => {\n        return !requestedPubkeys.includes(_pubkey)\n      })\n\n      return arr\n    })\n  }, [pubkey, setQueuedPubkeys, alreadyRequested, requestedPubkeys])\n\n  return {\n    pubkeysToFetch: isReadyToFetch ? queuedPubkeys : [],\n  }\n}\n\nexport function useProfile({\n  pubkey,\n  enabled: _enabled = true,\n}: {\n  pubkey: string\n  enabled?: boolean\n}) {\n  const [, setRequestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const { pubkeysToFetch } = useProfileQueue({ pubkey })\n  const enabled = _enabled && !!pubkeysToFetch.length\n\n  const [fetchedProfiles, setFetchedProfiles] = useAtom(fetchedProfilesAtom)\n\n  const { onEvent, onSubscribe, isLoading, onDone } = useNostrEvents({\n    filter: {\n      kinds: [0],\n      authors: pubkeysToFetch,\n    },\n    enabled,\n  })\n\n  onSubscribe(() => {\n    // Reset list\n    // (We've already opened a subscription to these pubkeys now)\n    setRequestedPubkeys((_pubkeys) => {\n      return [..._pubkeys, ...pubkeysToFetch].filter(uniqValues)\n    })\n  })\n\n  onEvent((rawMetadata) => {\n    try {\n      const metadata: Metadata = JSON.parse(rawMetadata.content)\n      const metaPubkey = rawMetadata.pubkey\n\n      if (metadata) {\n        setFetchedProfiles((_profiles: Record<string, Metadata>) => {\n          return {\n            ..._profiles,\n            [metaPubkey]: metadata,\n          }\n        })\n      }\n    } catch (err) {\n      console.error(err, rawMetadata)\n    }\n  })\n\n  const metadata = fetchedProfiles[pubkey]\n  const npub = nip19.npubEncode(pubkey)\n\n  return {\n    isLoading,\n    onDone,\n    data: metadata\n      ? {\n          ...metadata,\n          npub,\n        }\n      : undefined,\n  }\n}\n"],"names":["uniqBy","arr","key","Object","values","reduce","map","item","uniqValues","value","index","self","indexOf","dateToUnix","_date","date","Date","Math","floor","getTime","NostrContext","createContext","isLoading","connectedRelays","onConnect","onDisconnect","publish","log","isOn","type","args","console","NostrProvider","children","relayUrls","debug","useState","setIsLoading","setConnectedRelays","relays","setRelays","relayUrlsRef","useRef","onConnectCallback","onDisconnectCallback","disconnectToRelays","useCallback","forEach","relayUrl","find","relay","url","close","prev","filter","r","connectToRelays","relayInit","findIndex","connect","on","useEffect","current","relayUrlsToDisconnect","includes","event","_onConnectCallback","_onDisconnectCallback","_jsx","Provider","useNostr","useContext","useNostrEvents","enabled","isLoadingProvider","events","setEvents","unsubscribe","setUnsubscribe","onEventCallback","onSubscribeCallback","onDoneCallback","filterBase64","window","btoa","JSON","stringify","_unsubscribe","sub","unsub","subscribe","unsubscribeFunc","_events","relaySubs","uniqEvents","length","sortedEvents","sort","a","b","created_at","onSubscribe","_onSubscribeCallback","onEvent","_onEventCallback","onDone","_onDoneCallback","QUEUE_DEBOUNCE_DURATION","timer","undefined","queuedPubkeysAtom","atom","requestedPubkeysAtom","fetchedProfilesAtom","useProfileQueue","pubkey","isReadyToFetch","setIsReadyToFetch","useAtom","queuedPubkeys","setQueuedPubkeys","requestedPubkeys","alreadyRequested","clearTimeout","setTimeout","_pubkeys","_pubkey","pubkeysToFetch","useProfile","_enabled","setRequestedPubkeys","fetchedProfiles","setFetchedProfiles","kinds","authors","rawMetadata","metadata","parse","content","metaPubkey","_profiles","err","error","npub","nip19","npubEncode","data"],"mappings":"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"}
\ No newline at end of file
diff --git a/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js b/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js
index b7dbc31..4144b76 100644
--- a/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js
+++ b/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js
@@ -1,2 +1,2 @@
-"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react/jsx-runtime"),n=require("react"),e=require("nostr-tools"),r=require("jotai");function o(){o=function(){return t};var t={},n=Object.prototype,e=n.hasOwnProperty,r=Object.defineProperty||function(t,n,e){t[n]=e.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function f(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{f({},"")}catch(t){f=function(t,n,e){return t[n]=e}}function s(t,n,e,o){var i=Object.create((n&&n.prototype instanceof v?n:v).prototype),u=new _(o||[]);return r(i,"_invoke",{value:L(t,e,u)}),i}function l(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var h={};function v(){}function p(){}function d(){}var y={};f(y,u,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==n&&e.call(m,u)&&(y=m);var b=d.prototype=v.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(n){f(t,n,(function(t){return this._invoke(n,t)}))}))}function x(t,n){function o(r,i,u,c){var a=l(t[r],t,i);if("throw"!==a.type){var f=a.arg,s=f.value;return s&&"object"==typeof s&&e.call(s,"__await")?n.resolve(s.__await).then((function(t){o("next",t,u,c)}),(function(t){o("throw",t,u,c)})):n.resolve(s).then((function(t){f.value=t,u(f)}),(function(t){return o("throw",t,u,c)}))}c(a.arg)}var i;r(this,"_invoke",{value:function(t,e){function r(){return new n((function(n,r){o(t,e,n,r)}))}return i=i?i.then(r,r):r()}})}function L(t,n,e){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(e.method=o,e.arg=i;;){var u=e.delegate;if(u){var c=E(u,e);if(c){if(c===h)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===r)throw r="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);r="executing";var a=l(t,n,e);if("normal"===a.type){if(r=e.done?"completed":"suspendedYield",a.arg===h)continue;return{value:a.arg,done:e.done}}"throw"===a.type&&(r="completed",e.method="throw",e.arg=a.arg)}}}function E(t,n){var e=n.method,r=t.iterator[e];if(void 0===r)return n.delegate=null,"throw"===e&&t.iterator.return&&(n.method="return",n.arg=void 0,E(t,n),"throw"===n.method)||"return"!==e&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+e+"' method")),h;var o=l(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function O(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function j(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(e.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=void 0,n.done=!0,n};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return p.prototype=d,r(b,"constructor",{value:d,configurable:!0}),r(d,"constructor",{value:p,configurable:!0}),p.displayName=f(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===p||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,f(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(x.prototype),f(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(n,e,r,o,i){void 0===i&&(i=Promise);var u=new x(s(n,e,r,o),i);return t.isGeneratorFunction(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},w(b),f(b,a,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var n=Object(t),e=[];for(var r in n)e.push(r);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=k,_.prototype={constructor:_,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!t)for(var n in this)"t"===n.charAt(0)&&e.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(e,r){return u.type="throw",u.arg=t,n.next=e,r&&(n.method="next",n.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=e.call(i,"catchLoc"),a=e.call(i,"finallyLoc");if(c&&a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=t,u.arg=n,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(u)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),h},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),j(e),h}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var o=r.arg;j(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:k(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=void 0),h}},t}function i(t,n,e,r,o,i,u){try{var c=t[i](u),a=c.value}catch(t){return void e(t)}c.done?n(a):Promise.resolve(a).then(r,o)}function u(){return u=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},u.apply(this,arguments)}var c=function(t,n){return Object.values(t.reduce((function(t,e){var r;return u({},t,((r={})[""+e[n]]=e,r))}),{}))},a=function(t,n,e){return e.indexOf(t)===n},f=n.createContext({isLoading:!0,connectedRelays:[],onConnect:function(){return null},onDisconnect:function(){return null},publish:function(){return null}}),s=function(t,n){var e;if(t){for(var r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];(e=console)[n].apply(e,o)}};function l(){return n.useContext(f)}function h(t){var e=t.filter,r=t.enabled,o=void 0===r||r,i=l(),u=i.isLoading,a=i.onConnect,f=i.debug,h=i.connectedRelays,v=n.useState([]),p=v[0],d=v[1],y=n.useState((function(){})),g=y[0],m=y[1],b=null,w=null,x="undefined"!=typeof window?window.btoa(JSON.stringify(e)):null,L=function(t,n){return s(f,"info","ðŸ™‰ nostr ("+n.url+"): Unsubscribing from filter:",e),t.unsub()},E=n.useCallback((function(t,n){s(f,"info","ðŸ‘‚ nostr ("+t.url+"): Subscribing to filter:",n);var e=t.sub([n]),r=function(){L(e,t)};return m((function(){return r})),e.on("event",(function(n){s(f,"info","â¬‡ï¸ nostr ("+t.url+"): Received event:",n),null==b||b(n),d((function(t){return[n].concat(t)}))})),e}),[]);return n.useEffect((function(){if(o){var t=h.map((function(t){var n=E(t,e);return null==w||w(n,t),{sub:n,relay:t}}));return function(){t.forEach((function(t){L(t.sub,t.relay)}))}}}),[h,x,o]),{isLoading:u,events:(p.length>0?c(p,"id"):[]).sort((function(t,n){return n.created_at-t.created_at})),onConnect:a,connectedRelays:h,unsubscribe:g,onSubscribe:function(t){t&&(w=t)},onEvent:function(t){t&&(b=t)}}}var v=void 0,p=r.atom([]),d=r.atom([]),y=r.atom({});exports.NostrProvider=function(r){var u=r.children,a=r.relayUrls,l=r.debug,h=n.useState(!0),v=h[0],p=h[1],d=n.useState([]),y=d[0],g=d[1],m=null,b=null,w=n.useRef(!0),x=n.useCallback((function(){a.forEach(function(){var t,n=(t=o().mark((function t(n){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(r=e.relayInit(n)).connect(),r.on("connect",(function(){s(l,"info","âœ… nostr ("+n+"): Connected!"),p(!1),null==m||m(r),g((function(t){return c([].concat(t,[r]),"url")}))})),r.on("disconnect",(function(){s(l,"warn","ðŸšª nostr ("+n+"): Connection closed."),null==b||b(r),g((function(t){return t.filter((function(t){return t.url!==n}))}))})),r.on("error",(function(){s(l,"error","âŒ nostr ("+n+"): Connection error!")}));case 5:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(r,o){var u=t.apply(n,e);function c(t){i(u,r,o,c,a,"next",t)}function a(t){i(u,r,o,c,a,"throw",t)}c(void 0)}))});return function(t){return n.apply(this,arguments)}}())}),[]);return n.useEffect((function(){w.current&&(w.current=!1,x())}),[]),t.jsx(f.Provider,{value:{debug:l,isLoading:v,connectedRelays:y,publish:function(t){return y.map((function(n){return s(l,"info","â¬†ï¸ nostr ("+n.url+"): Sending event:",t),n.publish(t)}))},onConnect:function(t){t&&(m=t)},onDisconnect:function(t){t&&(b=t)}},children:u})},exports.dateToUnix=function(t){var n=t||new Date;return Math.floor(n.getTime()/1e3)},exports.uniqBy=c,exports.uniqValues=a,exports.useNostr=l,exports.useNostrEvents=h,exports.useProfile=function(t){var o=t.pubkey,i=r.useAtom(d)[1],c=function(t){var e=t.pubkey,o=n.useState(!1),i=o[0],u=o[1],c=r.useAtom(p),f=c[0],s=c[1],l=r.useAtom(d)[0],h=!!l.includes(e);return n.useEffect((function(){h||(clearTimeout(v),v=setTimeout((function(){u(!0)}),100),s((function(t){return[].concat(t,[e]).filter(a).filter((function(t){return!l.includes(t)}))})))}),[e,s,h,l]),{pubkeysToFetch:i?f:[]}}({pubkey:o}).pubkeysToFetch,f=!!c.length,s=r.useAtom(y),l=s[0],g=s[1],m=h({filter:{kinds:[0],authors:c},enabled:f}),b=m.onEvent;(0,m.onSubscribe)((function(){i((function(t){return[].concat(t,c).filter(a)}))})),b((function(t){try{var n=JSON.parse(t.content),e=t.pubkey;n&&g((function(t){var r;return u({},t,((r={})[e]=n,r))}))}catch(n){console.error(n,t)}}));var w=l[o],x=e.nip19.npubEncode(o);return{data:w?u({},w,{npub:x}):void 0}};
+"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react/jsx-runtime"),n=require("react"),e=require("nostr-tools"),r=require("jotai");function o(){o=function(){return t};var t={},n=Object.prototype,e=n.hasOwnProperty,r=Object.defineProperty||function(t,n,e){t[n]=e.value},i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function f(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{f({},"")}catch(t){f=function(t,n,e){return t[n]=e}}function s(t,n,e,o){var i=Object.create((n&&n.prototype instanceof v?n:v).prototype),u=new k(o||[]);return r(i,"_invoke",{value:L(t,e,u)}),i}function l(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var h={};function v(){}function p(){}function d(){}var y={};f(y,u,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(S([])));b&&b!==n&&e.call(b,u)&&(y=b);var m=d.prototype=v.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(n){f(t,n,(function(t){return this._invoke(n,t)}))}))}function x(t,n){function o(r,i,u,c){var a=l(t[r],t,i);if("throw"!==a.type){var f=a.arg,s=f.value;return s&&"object"==typeof s&&e.call(s,"__await")?n.resolve(s.__await).then((function(t){o("next",t,u,c)}),(function(t){o("throw",t,u,c)})):n.resolve(s).then((function(t){f.value=t,u(f)}),(function(t){return o("throw",t,u,c)}))}c(a.arg)}var i;r(this,"_invoke",{value:function(t,e){function r(){return new n((function(n,r){o(t,e,n,r)}))}return i=i?i.then(r,r):r()}})}function L(t,n,e){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(e.method=o,e.arg=i;;){var u=e.delegate;if(u){var c=E(u,e);if(c){if(c===h)continue;return c}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===r)throw r="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);r="executing";var a=l(t,n,e);if("normal"===a.type){if(r=e.done?"completed":"suspendedYield",a.arg===h)continue;return{value:a.arg,done:e.done}}"throw"===a.type&&(r="completed",e.method="throw",e.arg=a.arg)}}}function E(t,n){var e=n.method,r=t.iterator[e];if(void 0===r)return n.delegate=null,"throw"===e&&t.iterator.return&&(n.method="return",n.arg=void 0,E(t,n),"throw"===n.method)||"return"!==e&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+e+"' method")),h;var o=l(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function O(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function j(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function S(t){if(t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(e.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=void 0,n.done=!0,n};return o.next=o}}return{next:_}}function _(){return{value:void 0,done:!0}}return p.prototype=d,r(m,"constructor",{value:d,configurable:!0}),r(d,"constructor",{value:p,configurable:!0}),p.displayName=f(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===p||"GeneratorFunction"===(n.displayName||n.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,f(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},w(x.prototype),f(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(n,e,r,o,i){void 0===i&&(i=Promise);var u=new x(s(n,e,r,o),i);return t.isGeneratorFunction(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))},w(m),f(m,a,"Generator"),f(m,u,(function(){return this})),f(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var n=Object(t),e=[];for(var r in n)e.push(r);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=S,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!t)for(var n in this)"t"===n.charAt(0)&&e.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(e,r){return u.type="throw",u.arg=t,n.next=e,r&&(n.method="next",n.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],u=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=e.call(i,"catchLoc"),a=e.call(i,"finallyLoc");if(c&&a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&e.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var u=i?i.completion:{};return u.type=t,u.arg=n,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(u)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),h},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),j(e),h}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var o=r.arg;j(e)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,e){return this.delegate={iterator:S(t),resultName:n,nextLoc:e},"next"===this.method&&(this.arg=void 0),h}},t}function i(t,n,e,r,o,i,u){try{var c=t[i](u),a=c.value}catch(t){return void e(t)}c.done?n(a):Promise.resolve(a).then(r,o)}function u(t){return function(){var n=this,e=arguments;return new Promise((function(r,o){var u=t.apply(n,e);function c(t){i(u,r,o,c,a,"next",t)}function a(t){i(u,r,o,c,a,"throw",t)}c(void 0)}))}}function c(){return c=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},c.apply(this,arguments)}var a=function(t,n){return Object.values(t.reduce((function(t,e){var r;return c({},t,((r={})[""+e[n]]=e,r))}),{}))},f=function(t,n,e){return e.indexOf(t)===n},s=n.createContext({isLoading:!0,connectedRelays:[],onConnect:function(){return null},onDisconnect:function(){return null},publish:function(){return null}}),l=function(t,n){var e;if(t){for(var r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];(e=console)[n].apply(e,o)}};function h(){return n.useContext(s)}function v(t){var e=t.filter,r=t.enabled,o=void 0===r||r,i=h(),u=i.isLoading,c=i.onConnect,f=i.debug,s=i.connectedRelays,v=n.useState(!0),p=v[0],d=v[1],y=n.useState([]),g=y[0],b=y[1],m=n.useState((function(){})),w=m[0],x=m[1],L=null,E=null,O=null,j="undefined"!=typeof window?window.btoa(JSON.stringify(e)):null,k=function(t,n){return l(f,"info","ðŸ™‰ nostr ("+n.url+"): Unsubscribing from filter:",e),t.unsub()},S=n.useCallback((function(t,n){l(f,"info","ðŸ‘‚ nostr ("+t.url+"): Subscribing to filter:",n);var e=t.sub([n]);d(!0);var r=function(){k(e,t)};return x((function(){return r})),e.on("event",(function(n){l(f,"info","â¬‡ï¸ nostr ("+t.url+"): Received event:",n),null==L||L(n),b((function(t){return[n].concat(t)}))})),e.on("eose",(function(){d(!1),null==O||O()})),e}),[]);return n.useEffect((function(){if(o){var t=s.map((function(t){var n=S(t,e);return null==E||E(n,t),{sub:n,relay:t}}));return function(){t.forEach((function(t){k(t.sub,t.relay)}))}}}),[s,j,o]),{isLoading:p||u,events:(g.length>0?a(g,"id"):[]).sort((function(t,n){return n.created_at-t.created_at})),onConnect:c,connectedRelays:s,unsubscribe:w,onSubscribe:function(t){t&&(E=t)},onEvent:function(t){t&&(L=t)},onDone:function(t){t&&(O=t)}}}var p=void 0,d=r.atom([]),y=r.atom([]),g=r.atom({});exports.NostrProvider=function(r){var i=r.children,c=r.relayUrls,f=r.debug,h=n.useState(!0),v=h[0],p=h[1],d=n.useState([]),y=d[0],g=d[1],b=n.useState([]),m=b[0],w=b[1],x=n.useRef([]),L=null,E=null,O=n.useCallback((function(t){t.forEach(function(){var t=u(o().mark((function t(n){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==(e=m.find((function(t){return t.url===n})))?void 0:e.close();case 2:w((function(t){return t.filter((function(t){return t.url!==n}))}));case 3:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}())}),[m]),j=n.useCallback((function(t){t.forEach(function(){var t=u(o().mark((function t(n){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.relayInit(n),!(y.findIndex((function(t){return t.url===n}))>=0)){t.next=3;break}return t.abrupt("return");case 3:w((function(t){return a([].concat(t,[r]),"url")})),r.connect(),r.on("connect",(function(){l(f,"info","âœ… nostr ("+n+"): Connected!"),p(!1),null==L||L(r),g((function(t){return a([].concat(t,[r]),"url")}))})),r.on("disconnect",(function(){l(f,"warn","ðŸšª nostr ("+n+"): Connection closed."),null==E||E(r),g((function(t){return t.filter((function(t){return t.url!==n}))}))})),r.on("error",(function(){l(f,"error","âŒ nostr ("+n+"): Connection error!")}));case 8:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}())}),[y,f,L,E]);return n.useEffect((function(){if(x.current!==c){var t=x.current.filter((function(t){return!c.includes(t)}));O(t),j(c),x.current=c}}),[c,j,O]),t.jsx(s.Provider,{value:{debug:f,isLoading:v,connectedRelays:y,publish:function(t){return y.map((function(n){return l(f,"info","â¬†ï¸ nostr ("+n.url+"): Sending event:",t),n.publish(t)}))},onConnect:function(t){t&&(L=t)},onDisconnect:function(t){t&&(E=t)}},children:i})},exports.dateToUnix=function(t){var n=t||new Date;return Math.floor(n.getTime()/1e3)},exports.uniqBy=a,exports.uniqValues=f,exports.useNostr=h,exports.useNostrEvents=v,exports.useProfile=function(t){var o=t.pubkey,i=t.enabled,u=void 0===i||i,a=r.useAtom(y)[1],s=function(t){var e=t.pubkey,o=n.useState(!1),i=o[0],u=o[1],c=r.useAtom(d),a=c[0],s=c[1],l=r.useAtom(y)[0],h=!!l.includes(e);return n.useEffect((function(){h||(clearTimeout(p),p=setTimeout((function(){u(!0)}),100),s((function(t){return[].concat(t,[e]).filter(f).filter((function(t){return!l.includes(t)}))})))}),[e,s,h,l]),{pubkeysToFetch:i?a:[]}}({pubkey:o}).pubkeysToFetch,l=u&&!!s.length,h=r.useAtom(g),b=h[0],m=h[1],w=v({filter:{kinds:[0],authors:s},enabled:l}),x=w.onEvent,L=w.isLoading,E=w.onDone;(0,w.onSubscribe)((function(){a((function(t){return[].concat(t,s).filter(f)}))})),x((function(t){try{var n=JSON.parse(t.content),e=t.pubkey;n&&m((function(t){var r;return c({},t,((r={})[e]=n,r))}))}catch(n){console.error(n,t)}}));var O=b[o],j=e.nip19.npubEncode(o);return{isLoading:L,onDone:E,data:O?c({},O,{npub:j}):void 0}};
 //# sourceMappingURL=nostr-react.cjs.production.min.js.map
diff --git a/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js.map b/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js.map
index b9d4af5..3d95430 100644
--- a/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js.map
+++ b/node_modules/nostr-react/dist/nostr-react.cjs.production.min.js.map
@@ -1 +1 @@
-{"version":3,"file":"nostr-react.cjs.production.min.js","sources":["../src/utils.ts","../src/core.tsx","../src/useProfile.tsx"],"sourcesContent":["export const uniqBy = <T>(arr: T[], key: keyof T): T[] => {\n  return Object.values(\n    arr.reduce(\n      (map, item) => ({\n        ...map,\n        [`${item[key]}`]: item,\n      }),\n      {},\n    ),\n  )\n}\n\nexport const uniqValues = (value: string, index: number, self: string[]) => {\n  return self.indexOf(value) === index\n}\n\nexport const dateToUnix = (_date?: Date) => {\n  const date = _date || new Date()\n\n  return Math.floor(date.getTime() / 1000)\n}\n","import {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\nimport { Provider as JotaiProvider } from \"jotai\"\n\nimport { Relay, Filter, Event as NostrEvent, relayInit, Sub } from \"nostr-tools\"\n\nimport { uniqBy } from \"./utils\"\n\ntype OnConnectFunc = (relay: Relay) => void\ntype OnDisconnectFunc = (relay: Relay) => void\ntype OnEventFunc = (event: NostrEvent) => void\ntype OnSubscribeFunc = (sub: Sub, relay: Relay) => void\n\ninterface NostrContextType {\n  isLoading: boolean\n  debug?: boolean\n  connectedRelays: Relay[]\n  onConnect: (_onConnectCallback?: OnConnectFunc) => void\n  onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => void\n  publish: (event: NostrEvent) => void\n}\n\nconst NostrContext = createContext<NostrContextType>({\n  isLoading: true,\n  connectedRelays: [],\n  onConnect: () => null,\n  onDisconnect: () => null,\n  publish: () => null,\n})\n\nconst log = (\n  isOn: boolean | undefined,\n  type: \"info\" | \"error\" | \"warn\",\n  ...args: unknown[]\n) => {\n  if (!isOn) return\n  console[type](...args)\n}\n\nexport function NostrProvider({\n  children,\n  relayUrls,\n  debug,\n}: {\n  children: ReactNode\n  relayUrls: string[]\n  debug?: boolean\n}) {\n  const [isLoading, setIsLoading] = useState(true)\n  const [connectedRelays, setConnectedRelays] = useState<Relay[]>([])\n\n  let onConnectCallback: null | OnConnectFunc = null\n  let onDisconnectCallback: null | OnDisconnectFunc = null\n\n  const isFirstRender = useRef(true)\n\n  const connectToRelays = useCallback(() => {\n    relayUrls.forEach(async (relayUrl) => {\n      const relay = relayInit(relayUrl)\n      relay.connect()\n\n      relay.on(\"connect\", () => {\n        log(debug, \"info\", `âœ… nostr (${relayUrl}): Connected!`)\n        setIsLoading(false)\n        onConnectCallback?.(relay)\n        setConnectedRelays((prev) => uniqBy([...prev, relay], \"url\"))\n      })\n\n      relay.on(\"disconnect\", () => {\n        log(debug, \"warn\", `ðŸšª nostr (${relayUrl}): Connection closed.`)\n        onDisconnectCallback?.(relay)\n        setConnectedRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n      })\n\n      relay.on(\"error\", () => {\n        log(debug, \"error\", `âŒ nostr (${relayUrl}): Connection error!`)\n      })\n    })\n  }, [])\n\n  useEffect(() => {\n    // Make sure we only start the relays once (even in strict-mode)\n    if (isFirstRender.current) {\n      isFirstRender.current = false\n      connectToRelays()\n    }\n  }, [])\n\n  const publish = (event: NostrEvent) => {\n    return connectedRelays.map((relay) => {\n      log(debug, \"info\", `â¬†ï¸ nostr (${relay.url}): Sending event:`, event)\n\n      return relay.publish(event)\n    })\n  }\n\n  const value: NostrContextType = {\n    debug,\n    isLoading,\n    connectedRelays,\n    publish,\n    onConnect: (_onConnectCallback?: OnConnectFunc) => {\n      if (_onConnectCallback) {\n        onConnectCallback = _onConnectCallback\n      }\n    },\n    onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => {\n      if (_onDisconnectCallback) {\n        onDisconnectCallback = _onDisconnectCallback\n      }\n    },\n  }\n\n  return <NostrContext.Provider value={value}>{children}</NostrContext.Provider>\n}\n\nexport function useNostr() {\n  return useContext(NostrContext)\n}\n\nexport function useNostrEvents({\n  filter,\n  enabled = true,\n}: {\n  filter: Filter\n  enabled?: boolean\n}) {\n  const { isLoading, onConnect, debug, connectedRelays } = useNostr()\n  const [events, setEvents] = useState<NostrEvent[]>([])\n  const [unsubscribe, setUnsubscribe] = useState<() => void | void>(() => {\n    return\n  })\n\n  let onEventCallback: null | OnEventFunc = null\n  let onSubscribeCallback: null | OnSubscribeFunc = null\n\n  // Lets us detect changes in the nested filter object for the useEffect hook\n  const filterBase64 =\n    typeof window !== \"undefined\" ? window.btoa(JSON.stringify(filter)) : null\n\n  const _unsubscribe = (sub: Sub, relay: Relay) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ™‰ nostr (${relay.url}): Unsubscribing from filter:`,\n      filter,\n    )\n    return sub.unsub()\n  }\n\n  const subscribe = useCallback((relay: Relay, filter: Filter) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ‘‚ nostr (${relay.url}): Subscribing to filter:`,\n      filter,\n    )\n    const sub = relay.sub([filter])\n\n    const unsubscribeFunc = () => {\n      _unsubscribe(sub, relay)\n    }\n\n    setUnsubscribe(() => unsubscribeFunc)\n\n    sub.on(\"event\", (event: NostrEvent) => {\n      log(debug, \"info\", `â¬‡ï¸ nostr (${relay.url}): Received event:`, event)\n      onEventCallback?.(event)\n      setEvents((_events) => {\n        return [event, ..._events]\n      })\n    })\n\n    return sub\n  }, [])\n\n  useEffect(() => {\n    if (!enabled) return\n\n    const relaySubs = connectedRelays.map((relay) => {\n      const sub = subscribe(relay, filter)\n\n      onSubscribeCallback?.(sub, relay)\n\n      return {\n        sub,\n        relay,\n      }\n    })\n\n    return () => {\n      relaySubs.forEach(({ sub, relay }) => {\n        _unsubscribe(sub, relay)\n      })\n    }\n  }, [connectedRelays, filterBase64, enabled])\n\n  const uniqEvents = events.length > 0 ? uniqBy(events, \"id\") : []\n  const sortedEvents = uniqEvents.sort((a, b) => b.created_at - a.created_at)\n\n  return {\n    isLoading,\n    events: sortedEvents,\n    onConnect,\n    connectedRelays,\n    unsubscribe,\n    onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => {\n      if (_onSubscribeCallback) {\n        onSubscribeCallback = _onSubscribeCallback\n      }\n    },\n    onEvent: (_onEventCallback: OnEventFunc) => {\n      if (_onEventCallback) {\n        onEventCallback = _onEventCallback\n      }\n    },\n  }\n}\n","import { atom, useAtom } from \"jotai\"\nimport { nip19 } from \"nostr-tools\"\nimport { useEffect, useState } from \"react\"\n\nimport { useNostrEvents } from \"./core\"\nimport { uniqValues } from \"./utils\"\n\ninterface Metadata {\n  name?: string\n  display_name?: string\n  picture?: string\n  about?: string\n  website?: string\n  lud06?: string\n  lud16?: string\n  nip06?: string\n}\n\nconst QUEUE_DEBOUNCE_DURATION = 100\n\nlet timer: NodeJS.Timeout | undefined = undefined\n\nconst queuedPubkeysAtom = atom<string[]>([])\nconst requestedPubkeysAtom = atom<string[]>([])\nconst fetchedProfilesAtom = atom<Record<string, Metadata>>({})\n\nfunction useProfileQueue({ pubkey }: { pubkey: string }) {\n  const [isReadyToFetch, setIsReadyToFetch] = useState(false)\n\n  const [queuedPubkeys, setQueuedPubkeys] = useAtom(queuedPubkeysAtom)\n\n  const [requestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const alreadyRequested = !!requestedPubkeys.includes(pubkey)\n\n  useEffect(() => {\n    if (alreadyRequested) {\n      return\n    }\n\n    clearTimeout(timer)\n\n    timer = setTimeout(() => {\n      setIsReadyToFetch(true)\n    }, QUEUE_DEBOUNCE_DURATION)\n\n    setQueuedPubkeys((_pubkeys: string[]) => {\n      // Unique values only:\n      const arr = [..._pubkeys, pubkey].filter(uniqValues).filter((_pubkey) => {\n        return !requestedPubkeys.includes(_pubkey)\n      })\n\n      return arr\n    })\n  }, [pubkey, setQueuedPubkeys, alreadyRequested, requestedPubkeys])\n\n  return {\n    pubkeysToFetch: isReadyToFetch ? queuedPubkeys : [],\n  }\n}\n\nexport function useProfile({ pubkey }: { pubkey: string }) {\n  const [, setRequestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const { pubkeysToFetch } = useProfileQueue({ pubkey })\n  const enabled = !!pubkeysToFetch.length\n\n  const [fetchedProfiles, setFetchedProfiles] = useAtom(fetchedProfilesAtom)\n\n  const { onEvent, onSubscribe } = useNostrEvents({\n    filter: {\n      kinds: [0],\n      authors: pubkeysToFetch,\n    },\n    enabled,\n  })\n\n  onSubscribe(() => {\n    // Reset list\n    // (We've already opened a subscription to these pubkeys now)\n    setRequestedPubkeys((_pubkeys) => {\n      return [..._pubkeys, ...pubkeysToFetch].filter(uniqValues)\n    })\n  })\n\n  onEvent((rawMetadata) => {\n    try {\n      const metadata: Metadata = JSON.parse(rawMetadata.content)\n      const metaPubkey = rawMetadata.pubkey\n\n      if (metadata) {\n        setFetchedProfiles((_profiles: Record<string, Metadata>) => {\n          return {\n            ..._profiles,\n            [metaPubkey]: metadata,\n          }\n        })\n      }\n    } catch (err) {\n      console.error(err, rawMetadata)\n    }\n  })\n\n  const metadata = fetchedProfiles[pubkey]\n  const npub = nip19.npubEncode(pubkey)\n\n  return {\n    data: metadata\n      ? {\n          ...metadata,\n          npub,\n        }\n      : undefined,\n  }\n}\n"],"names":["uniqBy","arr","key","Object","values","reduce","map","item","_extends2","_extends","uniqValues","value","index","self","indexOf","NostrContext","createContext","isLoading","connectedRelays","onConnect","onDisconnect","publish","log","isOn","type","_console","_len","arguments","length","args","Array","_key","console","apply","useNostr","useContext","useNostrEvents","_ref3","filter","_ref3$enabled","enabled","_useNostr","debug","useState","events","_useState3","setEvents","unsubscribe","_useState4","setUnsubscribe","onEventCallback","onSubscribeCallback","filterBase64","window","btoa","JSON","stringify","_unsubscribe","sub","relay","url","unsub","subscribe","useCallback","unsubscribeFunc","on","event","_events","useEffect","relaySubs","forEach","_ref4","sort","a","b","created_at","onSubscribe","_onSubscribeCallback","onEvent","_onEventCallback","timer","undefined","queuedPubkeysAtom","atom","requestedPubkeysAtom","fetchedProfilesAtom","_ref","children","relayUrls","_useState","setIsLoading","_useState2","setConnectedRelays","onConnectCallback","onDisconnectCallback","isFirstRender","useRef","connectToRelays","_ref2","_regeneratorRuntime","mark","relayUrl","wrap","_context","prev","next","relayInit","connect","r","stop","_callee","_x","this","current","_jsx","jsx","Provider","_onConnectCallback","_onDisconnectCallback","_date","date","Date","Math","floor","getTime","pubkey","setRequestedPubkeys","useAtom","pubkeysToFetch","isReadyToFetch","setIsReadyToFetch","queuedPubkeys","_useAtom","setQueuedPubkeys","requestedPubkeys","alreadyRequested","includes","clearTimeout","setTimeout","_pubkeys","concat","_pubkey","useProfileQueue","fetchedProfiles","_useAtom4","setFetchedProfiles","_useNostrEvents","kinds","authors","rawMetadata","metadata","parse","content","metaPubkey","_profiles","err","error","npub","nip19","npubEncode","data"],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"nostr-react.cjs.production.min.js","sources":["../src/utils.ts","../src/core.tsx","../src/useProfile.tsx"],"sourcesContent":["export const uniqBy = <T>(arr: T[], key: keyof T): T[] => {\n  return Object.values(\n    arr.reduce(\n      (map, item) => ({\n        ...map,\n        [`${item[key]}`]: item,\n      }),\n      {},\n    ),\n  )\n}\n\nexport const uniqValues = (value: string, index: number, self: string[]) => {\n  return self.indexOf(value) === index\n}\n\nexport const dateToUnix = (_date?: Date) => {\n  const date = _date || new Date()\n\n  return Math.floor(date.getTime() / 1000)\n}\n","import {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\n\nimport { Relay, Filter, Event as NostrEvent, relayInit, Sub } from \"nostr-tools\"\n\nimport { uniqBy } from \"./utils\"\n\ntype OnConnectFunc = (relay: Relay) => void\ntype OnDisconnectFunc = (relay: Relay) => void\ntype OnEventFunc = (event: NostrEvent) => void\ntype OnDoneFunc = () => void\ntype OnSubscribeFunc = (sub: Sub, relay: Relay) => void\n\ninterface NostrContextType {\n  isLoading: boolean\n  debug?: boolean\n  connectedRelays: Relay[]\n  onConnect: (_onConnectCallback?: OnConnectFunc) => void\n  onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => void\n  publish: (event: NostrEvent) => void\n}\n\nconst NostrContext = createContext<NostrContextType>({\n  isLoading: true,\n  connectedRelays: [],\n  onConnect: () => null,\n  onDisconnect: () => null,\n  publish: () => null,\n})\n\nconst log = (\n  isOn: boolean | undefined,\n  type: \"info\" | \"error\" | \"warn\",\n  ...args: unknown[]\n) => {\n  if (!isOn) return\n  console[type](...args)\n}\n\nexport function NostrProvider({\n  children,\n  relayUrls,\n  debug,\n}: {\n  children: ReactNode\n  relayUrls: string[]\n  debug?: boolean\n}) {\n  const [isLoading, setIsLoading] = useState(true)\n  const [connectedRelays, setConnectedRelays] = useState<Relay[]>([])\n  const [relays, setRelays] = useState<Relay[]>([])\n  const relayUrlsRef = useRef<string[]>([])\n\n  let onConnectCallback: null | OnConnectFunc = null\n  let onDisconnectCallback: null | OnDisconnectFunc = null\n\n  const disconnectToRelays = useCallback(\n    (relayUrls: string[]) => {\n      relayUrls.forEach(async (relayUrl) => {\n        await relays.find((relay) => relay.url === relayUrl)?.close()\n        setRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n      })\n    },\n    [relays],\n  )\n\n  const connectToRelays = useCallback(\n    (relayUrls: string[]) => {\n      relayUrls.forEach(async (relayUrl) => {\n        const relay = relayInit(relayUrl)\n\n        if (connectedRelays.findIndex((r) => r.url === relayUrl) >= 0) {\n          // already connected, skip\n          return\n        }\n\n        setRelays((prev) => uniqBy([...prev, relay], \"url\"))\n        relay.connect()\n\n        relay.on(\"connect\", () => {\n          log(debug, \"info\", `âœ… nostr (${relayUrl}): Connected!`)\n          setIsLoading(false)\n          onConnectCallback?.(relay)\n          setConnectedRelays((prev) => uniqBy([...prev, relay], \"url\"))\n        })\n\n        relay.on(\"disconnect\", () => {\n          log(debug, \"warn\", `ðŸšª nostr (${relayUrl}): Connection closed.`)\n          onDisconnectCallback?.(relay)\n          setConnectedRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n        })\n\n        relay.on(\"error\", () => {\n          log(debug, \"error\", `âŒ nostr (${relayUrl}): Connection error!`)\n        })\n      })\n    },\n    [connectedRelays, debug, onConnectCallback, onDisconnectCallback],\n  )\n\n  useEffect(() => {\n    if (relayUrlsRef.current === relayUrls) {\n      // relayUrls isn't updated, skip\n      return\n    }\n\n    const relayUrlsToDisconnect = relayUrlsRef.current.filter(\n      (relayUrl) => !relayUrls.includes(relayUrl),\n    )\n\n    disconnectToRelays(relayUrlsToDisconnect)\n    connectToRelays(relayUrls)\n\n    relayUrlsRef.current = relayUrls\n  }, [relayUrls, connectToRelays, disconnectToRelays])\n\n  const publish = (event: NostrEvent) => {\n    return connectedRelays.map((relay) => {\n      log(debug, \"info\", `â¬†ï¸ nostr (${relay.url}): Sending event:`, event)\n\n      return relay.publish(event)\n    })\n  }\n\n  const value: NostrContextType = {\n    debug,\n    isLoading,\n    connectedRelays,\n    publish,\n    onConnect: (_onConnectCallback?: OnConnectFunc) => {\n      if (_onConnectCallback) {\n        onConnectCallback = _onConnectCallback\n      }\n    },\n    onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => {\n      if (_onDisconnectCallback) {\n        onDisconnectCallback = _onDisconnectCallback\n      }\n    },\n  }\n\n  return <NostrContext.Provider value={value}>{children}</NostrContext.Provider>\n}\n\nexport function useNostr() {\n  return useContext(NostrContext)\n}\n\nexport function useNostrEvents({\n  filter,\n  enabled = true,\n}: {\n  filter: Filter\n  enabled?: boolean\n}) {\n  const {\n    isLoading: isLoadingProvider,\n    onConnect,\n    debug,\n    connectedRelays,\n  } = useNostr()\n\n  const [isLoading, setIsLoading] = useState(true)\n  const [events, setEvents] = useState<NostrEvent[]>([])\n  const [unsubscribe, setUnsubscribe] = useState<() => void | void>(() => {\n    return\n  })\n\n  let onEventCallback: null | OnEventFunc = null\n  let onSubscribeCallback: null | OnSubscribeFunc = null\n  let onDoneCallback: null | OnDoneFunc = null\n\n  // Lets us detect changes in the nested filter object for the useEffect hook\n  const filterBase64 =\n    typeof window !== \"undefined\" ? window.btoa(JSON.stringify(filter)) : null\n\n  const _unsubscribe = (sub: Sub, relay: Relay) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ™‰ nostr (${relay.url}): Unsubscribing from filter:`,\n      filter,\n    )\n    return sub.unsub()\n  }\n\n  const subscribe = useCallback((relay: Relay, filter: Filter) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ‘‚ nostr (${relay.url}): Subscribing to filter:`,\n      filter,\n    )\n    const sub = relay.sub([filter])\n\n    setIsLoading(true)\n\n    const unsubscribeFunc = () => {\n      _unsubscribe(sub, relay)\n    }\n\n    setUnsubscribe(() => unsubscribeFunc)\n\n    sub.on(\"event\", (event: NostrEvent) => {\n      log(debug, \"info\", `â¬‡ï¸ nostr (${relay.url}): Received event:`, event)\n      onEventCallback?.(event)\n      setEvents((_events) => {\n        return [event, ..._events]\n      })\n    })\n\n    sub.on(\"eose\", () => {\n      setIsLoading(false)\n      onDoneCallback?.()\n    })\n\n    return sub\n  }, [])\n\n  useEffect(() => {\n    if (!enabled) return\n\n    const relaySubs = connectedRelays.map((relay) => {\n      const sub = subscribe(relay, filter)\n\n      onSubscribeCallback?.(sub, relay)\n\n      return {\n        sub,\n        relay,\n      }\n    })\n\n    return () => {\n      relaySubs.forEach(({ sub, relay }) => {\n        _unsubscribe(sub, relay)\n      })\n    }\n  }, [connectedRelays, filterBase64, enabled])\n\n  const uniqEvents = events.length > 0 ? uniqBy(events, \"id\") : []\n  const sortedEvents = uniqEvents.sort((a, b) => b.created_at - a.created_at)\n\n  return {\n    isLoading: isLoading || isLoadingProvider,\n    events: sortedEvents,\n    onConnect,\n    connectedRelays,\n    unsubscribe,\n    onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => {\n      if (_onSubscribeCallback) {\n        onSubscribeCallback = _onSubscribeCallback\n      }\n    },\n    onEvent: (_onEventCallback: OnEventFunc) => {\n      if (_onEventCallback) {\n        onEventCallback = _onEventCallback\n      }\n    },\n    onDone: (_onDoneCallback: OnDoneFunc) => {\n      if (_onDoneCallback) {\n        onDoneCallback = _onDoneCallback\n      }\n    },\n  }\n}\n","import { atom, useAtom } from \"jotai\"\nimport { nip19 } from \"nostr-tools\"\nimport { useEffect, useState } from \"react\"\n\nimport { useNostrEvents } from \"./core\"\nimport { uniqValues } from \"./utils\"\n\nexport interface Metadata {\n  name?: string\n  username?: string\n  display_name?: string\n  picture?: string\n  banner?: string\n  about?: string\n  website?: string\n  lud06?: string\n  lud16?: string\n  nip05?: string\n}\n\nconst QUEUE_DEBOUNCE_DURATION = 100\n\nlet timer: NodeJS.Timeout | undefined = undefined\n\nconst queuedPubkeysAtom = atom<string[]>([])\nconst requestedPubkeysAtom = atom<string[]>([])\nconst fetchedProfilesAtom = atom<Record<string, Metadata>>({})\n\nfunction useProfileQueue({ pubkey }: { pubkey: string }) {\n  const [isReadyToFetch, setIsReadyToFetch] = useState(false)\n\n  const [queuedPubkeys, setQueuedPubkeys] = useAtom(queuedPubkeysAtom)\n\n  const [requestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const alreadyRequested = !!requestedPubkeys.includes(pubkey)\n\n  useEffect(() => {\n    if (alreadyRequested) {\n      return\n    }\n\n    clearTimeout(timer)\n\n    timer = setTimeout(() => {\n      setIsReadyToFetch(true)\n    }, QUEUE_DEBOUNCE_DURATION)\n\n    setQueuedPubkeys((_pubkeys: string[]) => {\n      // Unique values only:\n      const arr = [..._pubkeys, pubkey].filter(uniqValues).filter((_pubkey) => {\n        return !requestedPubkeys.includes(_pubkey)\n      })\n\n      return arr\n    })\n  }, [pubkey, setQueuedPubkeys, alreadyRequested, requestedPubkeys])\n\n  return {\n    pubkeysToFetch: isReadyToFetch ? queuedPubkeys : [],\n  }\n}\n\nexport function useProfile({\n  pubkey,\n  enabled: _enabled = true,\n}: {\n  pubkey: string\n  enabled?: boolean\n}) {\n  const [, setRequestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const { pubkeysToFetch } = useProfileQueue({ pubkey })\n  const enabled = _enabled && !!pubkeysToFetch.length\n\n  const [fetchedProfiles, setFetchedProfiles] = useAtom(fetchedProfilesAtom)\n\n  const { onEvent, onSubscribe, isLoading, onDone } = useNostrEvents({\n    filter: {\n      kinds: [0],\n      authors: pubkeysToFetch,\n    },\n    enabled,\n  })\n\n  onSubscribe(() => {\n    // Reset list\n    // (We've already opened a subscription to these pubkeys now)\n    setRequestedPubkeys((_pubkeys) => {\n      return [..._pubkeys, ...pubkeysToFetch].filter(uniqValues)\n    })\n  })\n\n  onEvent((rawMetadata) => {\n    try {\n      const metadata: Metadata = JSON.parse(rawMetadata.content)\n      const metaPubkey = rawMetadata.pubkey\n\n      if (metadata) {\n        setFetchedProfiles((_profiles: Record<string, Metadata>) => {\n          return {\n            ..._profiles,\n            [metaPubkey]: metadata,\n          }\n        })\n      }\n    } catch (err) {\n      console.error(err, rawMetadata)\n    }\n  })\n\n  const metadata = fetchedProfiles[pubkey]\n  const npub = nip19.npubEncode(pubkey)\n\n  return {\n    isLoading,\n    onDone,\n    data: metadata\n      ? {\n          ...metadata,\n          npub,\n        }\n      : undefined,\n  }\n}\n"],"names":["uniqBy","arr","key","Object","values","reduce","map","item","_extends2","_extends","uniqValues","value","index","self","indexOf","NostrContext","createContext","isLoading","connectedRelays","onConnect","onDisconnect","publish","log","isOn","type","_console","_len","arguments","length","args","Array","_key","console","apply","useNostr","useContext","useNostrEvents","_ref4","filter","_ref4$enabled","enabled","_useNostr","isLoadingProvider","debug","useState","_useState4","setIsLoading","events","_useState5","setEvents","unsubscribe","_useState6","setUnsubscribe","onEventCallback","onSubscribeCallback","onDoneCallback","filterBase64","window","btoa","JSON","stringify","_unsubscribe","sub","relay","url","unsub","subscribe","useCallback","unsubscribeFunc","on","event","_events","useEffect","relaySubs","forEach","_ref5","sort","a","b","created_at","onSubscribe","_onSubscribeCallback","onEvent","_onEventCallback","onDone","_onDoneCallback","timer","undefined","queuedPubkeysAtom","atom","requestedPubkeysAtom","fetchedProfilesAtom","_ref","children","relayUrls","_useState","_useState2","setConnectedRelays","relays","_useState3","setRelays","relayUrlsRef","useRef","onConnectCallback","onDisconnectCallback","disconnectToRelays","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","relayUrl","_relays$find","wrap","_context","prev","next","find","close","r","stop","_callee","_x","this","connectToRelays","_ref3","_context2","relayInit","findIndex","abrupt","connect","_callee2","_x2","current","relayUrlsToDisconnect","includes","_jsx","jsx","Provider","_onConnectCallback","_onDisconnectCallback","_date","date","Date","Math","floor","getTime","pubkey","_ref2$enabled","_enabled","setRequestedPubkeys","useAtom","pubkeysToFetch","isReadyToFetch","setIsReadyToFetch","queuedPubkeys","_useAtom","setQueuedPubkeys","requestedPubkeys","alreadyRequested","clearTimeout","setTimeout","_pubkeys","concat","_pubkey","useProfileQueue","fetchedProfiles","_useAtom4","setFetchedProfiles","_useNostrEvents","kinds","authors","rawMetadata","metadata","parse","content","metaPubkey","_profiles","err","error","npub","nip19","npubEncode","data"],"mappings":"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"}
\ No newline at end of file
diff --git a/node_modules/nostr-react/dist/nostr-react.esm.js b/node_modules/nostr-react/dist/nostr-react.esm.js
index 4cfa928..9b06f4e 100644
--- a/node_modules/nostr-react/dist/nostr-react.esm.js
+++ b/node_modules/nostr-react/dist/nostr-react.esm.js
@@ -394,18 +394,62 @@ function NostrProvider(_ref) {
   var _useState2 = useState([]),
     connectedRelays = _useState2[0],
     setConnectedRelays = _useState2[1];
+  var _useState3 = useState([]),
+    relays = _useState3[0],
+    setRelays = _useState3[1];
+  var relayUrlsRef = useRef([]);
   var onConnectCallback = null;
   var onDisconnectCallback = null;
-  var isFirstRender = useRef(true);
-  var connectToRelays = useCallback(function () {
+  var disconnectToRelays = useCallback(function (relayUrls) {
     relayUrls.forEach( /*#__PURE__*/function () {
       var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(relayUrl) {
-        var relay;
+        var _relays$find;
         return _regeneratorRuntime().wrap(function _callee$(_context) {
           while (1) {
             switch (_context.prev = _context.next) {
+              case 0:
+                _context.next = 2;
+                return (_relays$find = relays.find(function (relay) {
+                  return relay.url === relayUrl;
+                })) == null ? void 0 : _relays$find.close();
+              case 2:
+                setRelays(function (prev) {
+                  return prev.filter(function (r) {
+                    return r.url !== relayUrl;
+                  });
+                });
+              case 3:
+              case "end":
+                return _context.stop();
+            }
+          }
+        }, _callee);
+      }));
+      return function (_x) {
+        return _ref2.apply(this, arguments);
+      };
+    }());
+  }, [relays]);
+  var connectToRelays = useCallback(function (relayUrls) {
+    relayUrls.forEach( /*#__PURE__*/function () {
+      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(relayUrl) {
+        var relay;
+        return _regeneratorRuntime().wrap(function _callee2$(_context2) {
+          while (1) {
+            switch (_context2.prev = _context2.next) {
               case 0:
                 relay = relayInit(relayUrl);
+                if (!(connectedRelays.findIndex(function (r) {
+                  return r.url === relayUrl;
+                }) >= 0)) {
+                  _context2.next = 3;
+                  break;
+                }
+                return _context2.abrupt("return");
+              case 3:
+                setRelays(function (prev) {
+                  return uniqBy([].concat(prev, [relay]), "url");
+                });
                 relay.connect();
                 relay.on("connect", function () {
                   log(debug, "info", "\u2705 nostr (" + relayUrl + "): Connected!");
@@ -427,25 +471,30 @@ function NostrProvider(_ref) {
                 relay.on("error", function () {
                   log(debug, "error", "\u274C nostr (" + relayUrl + "): Connection error!");
                 });
-              case 5:
+              case 8:
               case "end":
-                return _context.stop();
+                return _context2.stop();
             }
           }
-        }, _callee);
+        }, _callee2);
       }));
-      return function (_x) {
-        return _ref2.apply(this, arguments);
+      return function (_x2) {
+        return _ref3.apply(this, arguments);
       };
     }());
-  }, []);
+  }, [connectedRelays, debug, onConnectCallback, onDisconnectCallback]);
   useEffect(function () {
-    // Make sure we only start the relays once (even in strict-mode)
-    if (isFirstRender.current) {
-      isFirstRender.current = false;
-      connectToRelays();
+    if (relayUrlsRef.current === relayUrls) {
+      // relayUrls isn't updated, skip
+      return;
     }
-  }, []);
+    var relayUrlsToDisconnect = relayUrlsRef.current.filter(function (relayUrl) {
+      return !relayUrls.includes(relayUrl);
+    });
+    disconnectToRelays(relayUrlsToDisconnect);
+    connectToRelays(relayUrls);
+    relayUrlsRef.current = relayUrls;
+  }, [relayUrls, connectToRelays, disconnectToRelays]);
   var publish = function publish(event) {
     return connectedRelays.map(function (relay) {
       log(debug, "info", "\u2B06\uFE0F nostr (" + relay.url + "): Sending event:", event);
@@ -476,25 +525,29 @@ function NostrProvider(_ref) {
 function useNostr() {
   return useContext(NostrContext);
 }
-function useNostrEvents(_ref3) {
-  var filter = _ref3.filter,
-    _ref3$enabled = _ref3.enabled,
-    enabled = _ref3$enabled === void 0 ? true : _ref3$enabled;
+function useNostrEvents(_ref4) {
+  var filter = _ref4.filter,
+    _ref4$enabled = _ref4.enabled,
+    enabled = _ref4$enabled === void 0 ? true : _ref4$enabled;
   var _useNostr = useNostr(),
-    isLoading = _useNostr.isLoading,
+    isLoadingProvider = _useNostr.isLoading,
     onConnect = _useNostr.onConnect,
     debug = _useNostr.debug,
     connectedRelays = _useNostr.connectedRelays;
-  var _useState3 = useState([]),
-    events = _useState3[0],
-    setEvents = _useState3[1];
-  var _useState4 = useState(function () {
+  var _useState4 = useState(true),
+    isLoading = _useState4[0],
+    setIsLoading = _useState4[1];
+  var _useState5 = useState([]),
+    events = _useState5[0],
+    setEvents = _useState5[1];
+  var _useState6 = useState(function () {
       return;
     }),
-    unsubscribe = _useState4[0],
-    setUnsubscribe = _useState4[1];
+    unsubscribe = _useState6[0],
+    setUnsubscribe = _useState6[1];
   var onEventCallback = null;
   var onSubscribeCallback = null;
+  var onDoneCallback = null;
   // Lets us detect changes in the nested filter object for the useEffect hook
   var filterBase64 = typeof window !== "undefined" ? window.btoa(JSON.stringify(filter)) : null;
   var _unsubscribe = function _unsubscribe(sub, relay) {
@@ -504,6 +557,7 @@ function useNostrEvents(_ref3) {
   var subscribe = useCallback(function (relay, filter) {
     log(debug, "info", "\uD83D\uDC42 nostr (" + relay.url + "): Subscribing to filter:", filter);
     var sub = relay.sub([filter]);
+    setIsLoading(true);
     var unsubscribeFunc = function unsubscribeFunc() {
       _unsubscribe(sub, relay);
     };
@@ -517,6 +571,10 @@ function useNostrEvents(_ref3) {
         return [event].concat(_events);
       });
     });
+    sub.on("eose", function () {
+      setIsLoading(false);
+      onDoneCallback == null ? void 0 : onDoneCallback();
+    });
     return sub;
   }, []);
   useEffect(function () {
@@ -530,9 +588,9 @@ function useNostrEvents(_ref3) {
       };
     });
     return function () {
-      relaySubs.forEach(function (_ref4) {
-        var sub = _ref4.sub,
-          relay = _ref4.relay;
+      relaySubs.forEach(function (_ref5) {
+        var sub = _ref5.sub,
+          relay = _ref5.relay;
         _unsubscribe(sub, relay);
       });
     };
@@ -542,7 +600,7 @@ function useNostrEvents(_ref3) {
     return b.created_at - a.created_at;
   });
   return {
-    isLoading: isLoading,
+    isLoading: isLoading || isLoadingProvider,
     events: sortedEvents,
     onConnect: onConnect,
     connectedRelays: connectedRelays,
@@ -556,6 +614,11 @@ function useNostrEvents(_ref3) {
       if (_onEventCallback) {
         onEventCallback = _onEventCallback;
       }
+    },
+    onDone: function onDone(_onDoneCallback) {
+      if (_onDoneCallback) {
+        onDoneCallback = _onDoneCallback;
+      }
     }
   };
 }
@@ -597,14 +660,16 @@ function useProfileQueue(_ref) {
   };
 }
 function useProfile(_ref2) {
-  var pubkey = _ref2.pubkey;
+  var pubkey = _ref2.pubkey,
+    _ref2$enabled = _ref2.enabled,
+    _enabled = _ref2$enabled === void 0 ? true : _ref2$enabled;
   var _useAtom3 = useAtom(requestedPubkeysAtom),
     setRequestedPubkeys = _useAtom3[1];
   var _useProfileQueue = useProfileQueue({
       pubkey: pubkey
     }),
     pubkeysToFetch = _useProfileQueue.pubkeysToFetch;
-  var enabled = !!pubkeysToFetch.length;
+  var enabled = _enabled && !!pubkeysToFetch.length;
   var _useAtom4 = useAtom(fetchedProfilesAtom),
     fetchedProfiles = _useAtom4[0],
     setFetchedProfiles = _useAtom4[1];
@@ -616,7 +681,9 @@ function useProfile(_ref2) {
       enabled: enabled
     }),
     onEvent = _useNostrEvents.onEvent,
-    onSubscribe = _useNostrEvents.onSubscribe;
+    onSubscribe = _useNostrEvents.onSubscribe,
+    isLoading = _useNostrEvents.isLoading,
+    onDone = _useNostrEvents.onDone;
   onSubscribe(function () {
     // Reset list
     // (We've already opened a subscription to these pubkeys now)
@@ -641,6 +708,8 @@ function useProfile(_ref2) {
   var metadata = fetchedProfiles[pubkey];
   var npub = nip19.npubEncode(pubkey);
   return {
+    isLoading: isLoading,
+    onDone: onDone,
     data: metadata ? _extends({}, metadata, {
       npub: npub
     }) : undefined
diff --git a/node_modules/nostr-react/dist/nostr-react.esm.js.map b/node_modules/nostr-react/dist/nostr-react.esm.js.map
index 4394caa..541c8bb 100644
--- a/node_modules/nostr-react/dist/nostr-react.esm.js.map
+++ b/node_modules/nostr-react/dist/nostr-react.esm.js.map
@@ -1 +1 @@
-{"version":3,"file":"nostr-react.esm.js","sources":["../src/utils.ts","../src/core.tsx","../src/useProfile.tsx"],"sourcesContent":["export const uniqBy = <T>(arr: T[], key: keyof T): T[] => {\n  return Object.values(\n    arr.reduce(\n      (map, item) => ({\n        ...map,\n        [`${item[key]}`]: item,\n      }),\n      {},\n    ),\n  )\n}\n\nexport const uniqValues = (value: string, index: number, self: string[]) => {\n  return self.indexOf(value) === index\n}\n\nexport const dateToUnix = (_date?: Date) => {\n  const date = _date || new Date()\n\n  return Math.floor(date.getTime() / 1000)\n}\n","import {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\nimport { Provider as JotaiProvider } from \"jotai\"\n\nimport { Relay, Filter, Event as NostrEvent, relayInit, Sub } from \"nostr-tools\"\n\nimport { uniqBy } from \"./utils\"\n\ntype OnConnectFunc = (relay: Relay) => void\ntype OnDisconnectFunc = (relay: Relay) => void\ntype OnEventFunc = (event: NostrEvent) => void\ntype OnSubscribeFunc = (sub: Sub, relay: Relay) => void\n\ninterface NostrContextType {\n  isLoading: boolean\n  debug?: boolean\n  connectedRelays: Relay[]\n  onConnect: (_onConnectCallback?: OnConnectFunc) => void\n  onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => void\n  publish: (event: NostrEvent) => void\n}\n\nconst NostrContext = createContext<NostrContextType>({\n  isLoading: true,\n  connectedRelays: [],\n  onConnect: () => null,\n  onDisconnect: () => null,\n  publish: () => null,\n})\n\nconst log = (\n  isOn: boolean | undefined,\n  type: \"info\" | \"error\" | \"warn\",\n  ...args: unknown[]\n) => {\n  if (!isOn) return\n  console[type](...args)\n}\n\nexport function NostrProvider({\n  children,\n  relayUrls,\n  debug,\n}: {\n  children: ReactNode\n  relayUrls: string[]\n  debug?: boolean\n}) {\n  const [isLoading, setIsLoading] = useState(true)\n  const [connectedRelays, setConnectedRelays] = useState<Relay[]>([])\n\n  let onConnectCallback: null | OnConnectFunc = null\n  let onDisconnectCallback: null | OnDisconnectFunc = null\n\n  const isFirstRender = useRef(true)\n\n  const connectToRelays = useCallback(() => {\n    relayUrls.forEach(async (relayUrl) => {\n      const relay = relayInit(relayUrl)\n      relay.connect()\n\n      relay.on(\"connect\", () => {\n        log(debug, \"info\", `âœ… nostr (${relayUrl}): Connected!`)\n        setIsLoading(false)\n        onConnectCallback?.(relay)\n        setConnectedRelays((prev) => uniqBy([...prev, relay], \"url\"))\n      })\n\n      relay.on(\"disconnect\", () => {\n        log(debug, \"warn\", `ðŸšª nostr (${relayUrl}): Connection closed.`)\n        onDisconnectCallback?.(relay)\n        setConnectedRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n      })\n\n      relay.on(\"error\", () => {\n        log(debug, \"error\", `âŒ nostr (${relayUrl}): Connection error!`)\n      })\n    })\n  }, [])\n\n  useEffect(() => {\n    // Make sure we only start the relays once (even in strict-mode)\n    if (isFirstRender.current) {\n      isFirstRender.current = false\n      connectToRelays()\n    }\n  }, [])\n\n  const publish = (event: NostrEvent) => {\n    return connectedRelays.map((relay) => {\n      log(debug, \"info\", `â¬†ï¸ nostr (${relay.url}): Sending event:`, event)\n\n      return relay.publish(event)\n    })\n  }\n\n  const value: NostrContextType = {\n    debug,\n    isLoading,\n    connectedRelays,\n    publish,\n    onConnect: (_onConnectCallback?: OnConnectFunc) => {\n      if (_onConnectCallback) {\n        onConnectCallback = _onConnectCallback\n      }\n    },\n    onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => {\n      if (_onDisconnectCallback) {\n        onDisconnectCallback = _onDisconnectCallback\n      }\n    },\n  }\n\n  return <NostrContext.Provider value={value}>{children}</NostrContext.Provider>\n}\n\nexport function useNostr() {\n  return useContext(NostrContext)\n}\n\nexport function useNostrEvents({\n  filter,\n  enabled = true,\n}: {\n  filter: Filter\n  enabled?: boolean\n}) {\n  const { isLoading, onConnect, debug, connectedRelays } = useNostr()\n  const [events, setEvents] = useState<NostrEvent[]>([])\n  const [unsubscribe, setUnsubscribe] = useState<() => void | void>(() => {\n    return\n  })\n\n  let onEventCallback: null | OnEventFunc = null\n  let onSubscribeCallback: null | OnSubscribeFunc = null\n\n  // Lets us detect changes in the nested filter object for the useEffect hook\n  const filterBase64 =\n    typeof window !== \"undefined\" ? window.btoa(JSON.stringify(filter)) : null\n\n  const _unsubscribe = (sub: Sub, relay: Relay) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ™‰ nostr (${relay.url}): Unsubscribing from filter:`,\n      filter,\n    )\n    return sub.unsub()\n  }\n\n  const subscribe = useCallback((relay: Relay, filter: Filter) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ‘‚ nostr (${relay.url}): Subscribing to filter:`,\n      filter,\n    )\n    const sub = relay.sub([filter])\n\n    const unsubscribeFunc = () => {\n      _unsubscribe(sub, relay)\n    }\n\n    setUnsubscribe(() => unsubscribeFunc)\n\n    sub.on(\"event\", (event: NostrEvent) => {\n      log(debug, \"info\", `â¬‡ï¸ nostr (${relay.url}): Received event:`, event)\n      onEventCallback?.(event)\n      setEvents((_events) => {\n        return [event, ..._events]\n      })\n    })\n\n    return sub\n  }, [])\n\n  useEffect(() => {\n    if (!enabled) return\n\n    const relaySubs = connectedRelays.map((relay) => {\n      const sub = subscribe(relay, filter)\n\n      onSubscribeCallback?.(sub, relay)\n\n      return {\n        sub,\n        relay,\n      }\n    })\n\n    return () => {\n      relaySubs.forEach(({ sub, relay }) => {\n        _unsubscribe(sub, relay)\n      })\n    }\n  }, [connectedRelays, filterBase64, enabled])\n\n  const uniqEvents = events.length > 0 ? uniqBy(events, \"id\") : []\n  const sortedEvents = uniqEvents.sort((a, b) => b.created_at - a.created_at)\n\n  return {\n    isLoading,\n    events: sortedEvents,\n    onConnect,\n    connectedRelays,\n    unsubscribe,\n    onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => {\n      if (_onSubscribeCallback) {\n        onSubscribeCallback = _onSubscribeCallback\n      }\n    },\n    onEvent: (_onEventCallback: OnEventFunc) => {\n      if (_onEventCallback) {\n        onEventCallback = _onEventCallback\n      }\n    },\n  }\n}\n","import { atom, useAtom } from \"jotai\"\nimport { nip19 } from \"nostr-tools\"\nimport { useEffect, useState } from \"react\"\n\nimport { useNostrEvents } from \"./core\"\nimport { uniqValues } from \"./utils\"\n\ninterface Metadata {\n  name?: string\n  display_name?: string\n  picture?: string\n  about?: string\n  website?: string\n  lud06?: string\n  lud16?: string\n  nip06?: string\n}\n\nconst QUEUE_DEBOUNCE_DURATION = 100\n\nlet timer: NodeJS.Timeout | undefined = undefined\n\nconst queuedPubkeysAtom = atom<string[]>([])\nconst requestedPubkeysAtom = atom<string[]>([])\nconst fetchedProfilesAtom = atom<Record<string, Metadata>>({})\n\nfunction useProfileQueue({ pubkey }: { pubkey: string }) {\n  const [isReadyToFetch, setIsReadyToFetch] = useState(false)\n\n  const [queuedPubkeys, setQueuedPubkeys] = useAtom(queuedPubkeysAtom)\n\n  const [requestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const alreadyRequested = !!requestedPubkeys.includes(pubkey)\n\n  useEffect(() => {\n    if (alreadyRequested) {\n      return\n    }\n\n    clearTimeout(timer)\n\n    timer = setTimeout(() => {\n      setIsReadyToFetch(true)\n    }, QUEUE_DEBOUNCE_DURATION)\n\n    setQueuedPubkeys((_pubkeys: string[]) => {\n      // Unique values only:\n      const arr = [..._pubkeys, pubkey].filter(uniqValues).filter((_pubkey) => {\n        return !requestedPubkeys.includes(_pubkey)\n      })\n\n      return arr\n    })\n  }, [pubkey, setQueuedPubkeys, alreadyRequested, requestedPubkeys])\n\n  return {\n    pubkeysToFetch: isReadyToFetch ? queuedPubkeys : [],\n  }\n}\n\nexport function useProfile({ pubkey }: { pubkey: string }) {\n  const [, setRequestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const { pubkeysToFetch } = useProfileQueue({ pubkey })\n  const enabled = !!pubkeysToFetch.length\n\n  const [fetchedProfiles, setFetchedProfiles] = useAtom(fetchedProfilesAtom)\n\n  const { onEvent, onSubscribe } = useNostrEvents({\n    filter: {\n      kinds: [0],\n      authors: pubkeysToFetch,\n    },\n    enabled,\n  })\n\n  onSubscribe(() => {\n    // Reset list\n    // (We've already opened a subscription to these pubkeys now)\n    setRequestedPubkeys((_pubkeys) => {\n      return [..._pubkeys, ...pubkeysToFetch].filter(uniqValues)\n    })\n  })\n\n  onEvent((rawMetadata) => {\n    try {\n      const metadata: Metadata = JSON.parse(rawMetadata.content)\n      const metaPubkey = rawMetadata.pubkey\n\n      if (metadata) {\n        setFetchedProfiles((_profiles: Record<string, Metadata>) => {\n          return {\n            ..._profiles,\n            [metaPubkey]: metadata,\n          }\n        })\n      }\n    } catch (err) {\n      console.error(err, rawMetadata)\n    }\n  })\n\n  const metadata = fetchedProfiles[pubkey]\n  const npub = nip19.npubEncode(pubkey)\n\n  return {\n    data: metadata\n      ? {\n          ...metadata,\n          npub,\n        }\n      : undefined,\n  }\n}\n"],"names":["uniqBy","arr","key","Object","values","reduce","map","item","uniqValues","value","index","self","indexOf","dateToUnix","_date","date","Date","Math","floor","getTime","NostrContext","createContext","isLoading","connectedRelays","onConnect","onDisconnect","publish","log","isOn","type","args","console","NostrProvider","children","relayUrls","debug","useState","setIsLoading","setConnectedRelays","onConnectCallback","onDisconnectCallback","isFirstRender","useRef","connectToRelays","useCallback","forEach","relayUrl","relay","relayInit","connect","on","prev","filter","r","url","useEffect","current","event","_onConnectCallback","_onDisconnectCallback","_jsx","Provider","useNostr","useContext","useNostrEvents","enabled","events","setEvents","unsubscribe","setUnsubscribe","onEventCallback","onSubscribeCallback","filterBase64","window","btoa","JSON","stringify","_unsubscribe","sub","unsub","subscribe","unsubscribeFunc","_events","relaySubs","uniqEvents","length","sortedEvents","sort","a","b","created_at","onSubscribe","_onSubscribeCallback","onEvent","_onEventCallback","QUEUE_DEBOUNCE_DURATION","timer","undefined","queuedPubkeysAtom","atom","requestedPubkeysAtom","fetchedProfilesAtom","useProfileQueue","pubkey","isReadyToFetch","setIsReadyToFetch","useAtom","queuedPubkeys","setQueuedPubkeys","requestedPubkeys","alreadyRequested","includes","clearTimeout","setTimeout","_pubkeys","_pubkey","pubkeysToFetch","useProfile","setRequestedPubkeys","fetchedProfiles","setFetchedProfiles","kinds","authors","rawMetadata","metadata","parse","content","metaPubkey","_profiles","err","error","npub","nip19","npubEncode","data"],"mappings":"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"}
\ No newline at end of file
+{"version":3,"file":"nostr-react.esm.js","sources":["../src/utils.ts","../src/core.tsx","../src/useProfile.tsx"],"sourcesContent":["export const uniqBy = <T>(arr: T[], key: keyof T): T[] => {\n  return Object.values(\n    arr.reduce(\n      (map, item) => ({\n        ...map,\n        [`${item[key]}`]: item,\n      }),\n      {},\n    ),\n  )\n}\n\nexport const uniqValues = (value: string, index: number, self: string[]) => {\n  return self.indexOf(value) === index\n}\n\nexport const dateToUnix = (_date?: Date) => {\n  const date = _date || new Date()\n\n  return Math.floor(date.getTime() / 1000)\n}\n","import {\n  createContext,\n  ReactNode,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\n\nimport { Relay, Filter, Event as NostrEvent, relayInit, Sub } from \"nostr-tools\"\n\nimport { uniqBy } from \"./utils\"\n\ntype OnConnectFunc = (relay: Relay) => void\ntype OnDisconnectFunc = (relay: Relay) => void\ntype OnEventFunc = (event: NostrEvent) => void\ntype OnDoneFunc = () => void\ntype OnSubscribeFunc = (sub: Sub, relay: Relay) => void\n\ninterface NostrContextType {\n  isLoading: boolean\n  debug?: boolean\n  connectedRelays: Relay[]\n  onConnect: (_onConnectCallback?: OnConnectFunc) => void\n  onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => void\n  publish: (event: NostrEvent) => void\n}\n\nconst NostrContext = createContext<NostrContextType>({\n  isLoading: true,\n  connectedRelays: [],\n  onConnect: () => null,\n  onDisconnect: () => null,\n  publish: () => null,\n})\n\nconst log = (\n  isOn: boolean | undefined,\n  type: \"info\" | \"error\" | \"warn\",\n  ...args: unknown[]\n) => {\n  if (!isOn) return\n  console[type](...args)\n}\n\nexport function NostrProvider({\n  children,\n  relayUrls,\n  debug,\n}: {\n  children: ReactNode\n  relayUrls: string[]\n  debug?: boolean\n}) {\n  const [isLoading, setIsLoading] = useState(true)\n  const [connectedRelays, setConnectedRelays] = useState<Relay[]>([])\n  const [relays, setRelays] = useState<Relay[]>([])\n  const relayUrlsRef = useRef<string[]>([])\n\n  let onConnectCallback: null | OnConnectFunc = null\n  let onDisconnectCallback: null | OnDisconnectFunc = null\n\n  const disconnectToRelays = useCallback(\n    (relayUrls: string[]) => {\n      relayUrls.forEach(async (relayUrl) => {\n        await relays.find((relay) => relay.url === relayUrl)?.close()\n        setRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n      })\n    },\n    [relays],\n  )\n\n  const connectToRelays = useCallback(\n    (relayUrls: string[]) => {\n      relayUrls.forEach(async (relayUrl) => {\n        const relay = relayInit(relayUrl)\n\n        if (connectedRelays.findIndex((r) => r.url === relayUrl) >= 0) {\n          // already connected, skip\n          return\n        }\n\n        setRelays((prev) => uniqBy([...prev, relay], \"url\"))\n        relay.connect()\n\n        relay.on(\"connect\", () => {\n          log(debug, \"info\", `âœ… nostr (${relayUrl}): Connected!`)\n          setIsLoading(false)\n          onConnectCallback?.(relay)\n          setConnectedRelays((prev) => uniqBy([...prev, relay], \"url\"))\n        })\n\n        relay.on(\"disconnect\", () => {\n          log(debug, \"warn\", `ðŸšª nostr (${relayUrl}): Connection closed.`)\n          onDisconnectCallback?.(relay)\n          setConnectedRelays((prev) => prev.filter((r) => r.url !== relayUrl))\n        })\n\n        relay.on(\"error\", () => {\n          log(debug, \"error\", `âŒ nostr (${relayUrl}): Connection error!`)\n        })\n      })\n    },\n    [connectedRelays, debug, onConnectCallback, onDisconnectCallback],\n  )\n\n  useEffect(() => {\n    if (relayUrlsRef.current === relayUrls) {\n      // relayUrls isn't updated, skip\n      return\n    }\n\n    const relayUrlsToDisconnect = relayUrlsRef.current.filter(\n      (relayUrl) => !relayUrls.includes(relayUrl),\n    )\n\n    disconnectToRelays(relayUrlsToDisconnect)\n    connectToRelays(relayUrls)\n\n    relayUrlsRef.current = relayUrls\n  }, [relayUrls, connectToRelays, disconnectToRelays])\n\n  const publish = (event: NostrEvent) => {\n    return connectedRelays.map((relay) => {\n      log(debug, \"info\", `â¬†ï¸ nostr (${relay.url}): Sending event:`, event)\n\n      return relay.publish(event)\n    })\n  }\n\n  const value: NostrContextType = {\n    debug,\n    isLoading,\n    connectedRelays,\n    publish,\n    onConnect: (_onConnectCallback?: OnConnectFunc) => {\n      if (_onConnectCallback) {\n        onConnectCallback = _onConnectCallback\n      }\n    },\n    onDisconnect: (_onDisconnectCallback?: OnDisconnectFunc) => {\n      if (_onDisconnectCallback) {\n        onDisconnectCallback = _onDisconnectCallback\n      }\n    },\n  }\n\n  return <NostrContext.Provider value={value}>{children}</NostrContext.Provider>\n}\n\nexport function useNostr() {\n  return useContext(NostrContext)\n}\n\nexport function useNostrEvents({\n  filter,\n  enabled = true,\n}: {\n  filter: Filter\n  enabled?: boolean\n}) {\n  const {\n    isLoading: isLoadingProvider,\n    onConnect,\n    debug,\n    connectedRelays,\n  } = useNostr()\n\n  const [isLoading, setIsLoading] = useState(true)\n  const [events, setEvents] = useState<NostrEvent[]>([])\n  const [unsubscribe, setUnsubscribe] = useState<() => void | void>(() => {\n    return\n  })\n\n  let onEventCallback: null | OnEventFunc = null\n  let onSubscribeCallback: null | OnSubscribeFunc = null\n  let onDoneCallback: null | OnDoneFunc = null\n\n  // Lets us detect changes in the nested filter object for the useEffect hook\n  const filterBase64 =\n    typeof window !== \"undefined\" ? window.btoa(JSON.stringify(filter)) : null\n\n  const _unsubscribe = (sub: Sub, relay: Relay) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ™‰ nostr (${relay.url}): Unsubscribing from filter:`,\n      filter,\n    )\n    return sub.unsub()\n  }\n\n  const subscribe = useCallback((relay: Relay, filter: Filter) => {\n    log(\n      debug,\n      \"info\",\n      `ðŸ‘‚ nostr (${relay.url}): Subscribing to filter:`,\n      filter,\n    )\n    const sub = relay.sub([filter])\n\n    setIsLoading(true)\n\n    const unsubscribeFunc = () => {\n      _unsubscribe(sub, relay)\n    }\n\n    setUnsubscribe(() => unsubscribeFunc)\n\n    sub.on(\"event\", (event: NostrEvent) => {\n      log(debug, \"info\", `â¬‡ï¸ nostr (${relay.url}): Received event:`, event)\n      onEventCallback?.(event)\n      setEvents((_events) => {\n        return [event, ..._events]\n      })\n    })\n\n    sub.on(\"eose\", () => {\n      setIsLoading(false)\n      onDoneCallback?.()\n    })\n\n    return sub\n  }, [])\n\n  useEffect(() => {\n    if (!enabled) return\n\n    const relaySubs = connectedRelays.map((relay) => {\n      const sub = subscribe(relay, filter)\n\n      onSubscribeCallback?.(sub, relay)\n\n      return {\n        sub,\n        relay,\n      }\n    })\n\n    return () => {\n      relaySubs.forEach(({ sub, relay }) => {\n        _unsubscribe(sub, relay)\n      })\n    }\n  }, [connectedRelays, filterBase64, enabled])\n\n  const uniqEvents = events.length > 0 ? uniqBy(events, \"id\") : []\n  const sortedEvents = uniqEvents.sort((a, b) => b.created_at - a.created_at)\n\n  return {\n    isLoading: isLoading || isLoadingProvider,\n    events: sortedEvents,\n    onConnect,\n    connectedRelays,\n    unsubscribe,\n    onSubscribe: (_onSubscribeCallback: OnSubscribeFunc) => {\n      if (_onSubscribeCallback) {\n        onSubscribeCallback = _onSubscribeCallback\n      }\n    },\n    onEvent: (_onEventCallback: OnEventFunc) => {\n      if (_onEventCallback) {\n        onEventCallback = _onEventCallback\n      }\n    },\n    onDone: (_onDoneCallback: OnDoneFunc) => {\n      if (_onDoneCallback) {\n        onDoneCallback = _onDoneCallback\n      }\n    },\n  }\n}\n","import { atom, useAtom } from \"jotai\"\nimport { nip19 } from \"nostr-tools\"\nimport { useEffect, useState } from \"react\"\n\nimport { useNostrEvents } from \"./core\"\nimport { uniqValues } from \"./utils\"\n\nexport interface Metadata {\n  name?: string\n  username?: string\n  display_name?: string\n  picture?: string\n  banner?: string\n  about?: string\n  website?: string\n  lud06?: string\n  lud16?: string\n  nip05?: string\n}\n\nconst QUEUE_DEBOUNCE_DURATION = 100\n\nlet timer: NodeJS.Timeout | undefined = undefined\n\nconst queuedPubkeysAtom = atom<string[]>([])\nconst requestedPubkeysAtom = atom<string[]>([])\nconst fetchedProfilesAtom = atom<Record<string, Metadata>>({})\n\nfunction useProfileQueue({ pubkey }: { pubkey: string }) {\n  const [isReadyToFetch, setIsReadyToFetch] = useState(false)\n\n  const [queuedPubkeys, setQueuedPubkeys] = useAtom(queuedPubkeysAtom)\n\n  const [requestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const alreadyRequested = !!requestedPubkeys.includes(pubkey)\n\n  useEffect(() => {\n    if (alreadyRequested) {\n      return\n    }\n\n    clearTimeout(timer)\n\n    timer = setTimeout(() => {\n      setIsReadyToFetch(true)\n    }, QUEUE_DEBOUNCE_DURATION)\n\n    setQueuedPubkeys((_pubkeys: string[]) => {\n      // Unique values only:\n      const arr = [..._pubkeys, pubkey].filter(uniqValues).filter((_pubkey) => {\n        return !requestedPubkeys.includes(_pubkey)\n      })\n\n      return arr\n    })\n  }, [pubkey, setQueuedPubkeys, alreadyRequested, requestedPubkeys])\n\n  return {\n    pubkeysToFetch: isReadyToFetch ? queuedPubkeys : [],\n  }\n}\n\nexport function useProfile({\n  pubkey,\n  enabled: _enabled = true,\n}: {\n  pubkey: string\n  enabled?: boolean\n}) {\n  const [, setRequestedPubkeys] = useAtom(requestedPubkeysAtom)\n  const { pubkeysToFetch } = useProfileQueue({ pubkey })\n  const enabled = _enabled && !!pubkeysToFetch.length\n\n  const [fetchedProfiles, setFetchedProfiles] = useAtom(fetchedProfilesAtom)\n\n  const { onEvent, onSubscribe, isLoading, onDone } = useNostrEvents({\n    filter: {\n      kinds: [0],\n      authors: pubkeysToFetch,\n    },\n    enabled,\n  })\n\n  onSubscribe(() => {\n    // Reset list\n    // (We've already opened a subscription to these pubkeys now)\n    setRequestedPubkeys((_pubkeys) => {\n      return [..._pubkeys, ...pubkeysToFetch].filter(uniqValues)\n    })\n  })\n\n  onEvent((rawMetadata) => {\n    try {\n      const metadata: Metadata = JSON.parse(rawMetadata.content)\n      const metaPubkey = rawMetadata.pubkey\n\n      if (metadata) {\n        setFetchedProfiles((_profiles: Record<string, Metadata>) => {\n          return {\n            ..._profiles,\n            [metaPubkey]: metadata,\n          }\n        })\n      }\n    } catch (err) {\n      console.error(err, rawMetadata)\n    }\n  })\n\n  const metadata = fetchedProfiles[pubkey]\n  const npub = nip19.npubEncode(pubkey)\n\n  return {\n    isLoading,\n    onDone,\n    data: metadata\n      ? {\n          ...metadata,\n          npub,\n        }\n      : undefined,\n  }\n}\n"],"names":["uniqBy","arr","key","Object","values","reduce","map","item","uniqValues","value","index","self","indexOf","dateToUnix","_date","date","Date","Math","floor","getTime","NostrContext","createContext","isLoading","connectedRelays","onConnect","onDisconnect","publish","log","isOn","type","args","console","NostrProvider","children","relayUrls","debug","useState","setIsLoading","setConnectedRelays","relays","setRelays","relayUrlsRef","useRef","onConnectCallback","onDisconnectCallback","disconnectToRelays","useCallback","forEach","relayUrl","find","relay","url","close","prev","filter","r","connectToRelays","relayInit","findIndex","connect","on","useEffect","current","relayUrlsToDisconnect","includes","event","_onConnectCallback","_onDisconnectCallback","_jsx","Provider","useNostr","useContext","useNostrEvents","enabled","isLoadingProvider","events","setEvents","unsubscribe","setUnsubscribe","onEventCallback","onSubscribeCallback","onDoneCallback","filterBase64","window","btoa","JSON","stringify","_unsubscribe","sub","unsub","subscribe","unsubscribeFunc","_events","relaySubs","uniqEvents","length","sortedEvents","sort","a","b","created_at","onSubscribe","_onSubscribeCallback","onEvent","_onEventCallback","onDone","_onDoneCallback","QUEUE_DEBOUNCE_DURATION","timer","undefined","queuedPubkeysAtom","atom","requestedPubkeysAtom","fetchedProfilesAtom","useProfileQueue","pubkey","isReadyToFetch","setIsReadyToFetch","useAtom","queuedPubkeys","setQueuedPubkeys","requestedPubkeys","alreadyRequested","clearTimeout","setTimeout","_pubkeys","_pubkey","pubkeysToFetch","useProfile","_enabled","setRequestedPubkeys","fetchedProfiles","setFetchedProfiles","kinds","authors","rawMetadata","metadata","parse","content","metaPubkey","_profiles","err","error","npub","nip19","npubEncode","data"],"mappings":"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"}
\ No newline at end of file
diff --git a/node_modules/nostr-react/dist/useProfile.d.ts b/node_modules/nostr-react/dist/useProfile.d.ts
index 43eaf70..52fd883 100644
--- a/node_modules/nostr-react/dist/useProfile.d.ts
+++ b/node_modules/nostr-react/dist/useProfile.d.ts
@@ -1,15 +1,32 @@
-export declare function useProfile({ pubkey }: {
+export interface Metadata {
+    name?: string;
+    username?: string;
+    display_name?: string;
+    picture?: string;
+    banner?: string;
+    about?: string;
+    website?: string;
+    lud06?: string;
+    lud16?: string;
+    nip05?: string;
+}
+export declare function useProfile({ pubkey, enabled: _enabled, }: {
     pubkey: string;
+    enabled?: boolean;
 }): {
+    isLoading: boolean;
+    onDone: (_onDoneCallback: () => void) => void;
     data: {
         npub: string;
         name?: string | undefined;
+        username?: string | undefined;
         display_name?: string | undefined;
         picture?: string | undefined;
+        banner?: string | undefined;
         about?: string | undefined;
         website?: string | undefined;
         lud06?: string | undefined;
         lud16?: string | undefined;
-        nip06?: string | undefined;
+        nip05?: string | undefined;
     } | undefined;
 };
